<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Forrest Ye's Blog]]></title>
  <link href="http://forresty.com/atom.xml" rel="self"/>
  <link href="http://forresty.com/"/>
  <updated>2012-12-12T15:22:40+08:00</updated>
  <id>http://forresty.com/</id>
  <author>
    <name><![CDATA[Forrest Ye]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ayi loves you]]></title>
    <link href="http://forresty.com/blog/2012/12/11/ayi-loves-you/"/>
    <updated>2012-12-11T17:26:00+08:00</updated>
    <id>http://forresty.com/blog/2012/12/11/ayi-loves-you</id>
    <content type="html"><![CDATA[<p>Recently I read a lot of open source code, some of them are really nice, some of them suck.</p>

<p>Since I have my TextMate 2 set up so trailing whitespace and <code>\t</code> in Ruby files are highlighted, every now and then when I stumble upon those patterns, I find myself fixing them locally, and depending on my mood, I might send them a pull request.</p>

<p>Though I have a keyboard shortcut set up in my TextMate so it&#8217;s just a trivial task for each file, but it&#8217;s really annoying to see them coming up again and again, right?</p>

<p>When yesterday my <a href="https://github.com/capistrano/capistrano/pull/319">pull request to capistrano</a> was rejected and was told by this nice guy called Roy Liu, that rather than fixing them file by file, it&#8217;s preferred to do it in batch.</p>

<p>So today I literally went through the entire project, read through the code, trying to understand them while fixing the styles. Oh man it hurts my eyes.</p>

<p>Obviously some tasks are better done using automation. Thus in a hurry I wrote this little <a href="https://github.com/forresty/ayi">ayi gem</a>.</p>

<p>Basically it clean up codes for you, and I intend to make it do this one thing and do it well.</p>

<p>Of course It&#8217;s now still very early in development, but let&#8217;s hope it will become more and more powerful as time goes by.</p>

<p>Go <a href="https://github.com/forresty/ayi">take a look at it</a> if you are interested.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My Stuffs]]></title>
    <link href="http://forresty.com/blog/2012/12/11/my-stuffs/"/>
    <updated>2012-12-11T13:52:00+08:00</updated>
    <id>http://forresty.com/blog/2012/12/11/my-stuffs</id>
    <content type="html"><![CDATA[<p>I <a href="http://forresty.com/blog/2012/11/17/anti-social-at-its-best/">blogged about simplifying my life</a> and mentioned about a list of my stuffs, since I know some of you might be interested, I am now making it public.</p>

<p><a href="http://forresty.com/stuffs">Here is the list</a>.</p>

<p>It&#8217;s undergoing constant changes of course, I may try, but I make no promises to keep it up-to-date here.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[THINKING OUT LOUD]]></title>
    <link href="http://forresty.com/blog/2012/12/09/thinking-out-loud/"/>
    <updated>2012-12-09T13:55:00+08:00</updated>
    <id>http://forresty.com/blog/2012/12/09/thinking-out-loud</id>
    <content type="html"><![CDATA[<p>This world is full of thoughtful thinkers who don&#8217;t speak out loud enough, talkative hyperactive doers who don&#8217;t think enough, passive nihilistic people who hate this world and hate themselves, and mindless lazy people who know nothing but to lamely entertain themselves.</p>

<p>So I say, hey sexy world, I am here to make you a better place.</p>

<p>I intend to think out loud till I feel I&#8217;ve satisfied myself.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MBTI explained]]></title>
    <link href="http://forresty.com/blog/2012/12/09/mbti-explained/"/>
    <updated>2012-12-09T10:59:00+08:00</updated>
    <id>http://forresty.com/blog/2012/12/09/mbti-explained</id>
    <content type="html"><![CDATA[<p>So I <a href="http://forresty.com/blog/2012/12/06/intp/">blogged about me taking online MBTI tests again</a> and found myself have changed from the ENFP type to INTP type and might become an INTJ without telling you guys what MBTI is and wtf are ENFP and INTP and INTJ.</p>

<p>Okay I know most of you are either too lazy or too busy to look into those jargons yourselves, so I am here to give a brief talk about MBTI.</p>

<p>So basically <a href="http://en.wikipedia.org/wiki/Myers-Briggs_Type_Indicator">MBTI</a> is an indicator which reflects your psychological preferences and how you perceive the world and make decisions. It&#8217;s based on the work of <a href="http://en.wikipedia.org/wiki/Carl_Jung">Carl Jung</a> if you are wondering.</p>

<p>There are many free online MBTI tests in languages of your preferences, just Google it yourself. I took several quick ones in both Chinese and English just to make sure the results are consistent.</p>

<p>The MBTI basically categorize people into 16 groups based on 4 sub-types (2 ^ 4 == 16, hence the 4 character type name ENFP or INTJ).</p>

<p>Those sub-types are:</p>

<ul>
<li>Extraversion (E) –  (I) Introversion</li>
<li>Sensing (S) –   (N) Intuition</li>
<li>Thinking (T) –  (F) Feeling</li>
<li>Judging (J) –   (P) Perception</li>
</ul>


<h2>Extraversion (E) – (I) Introversion</h2>

<p>Basically extraverts feels more comfortable when spending time with people, while introverts get their energy from spending time alone.</p>

<h2>Sensing (S) –  (N) Intuition</h2>

<p>People who prefer sensing are data oriented, they prefer to look for details and facts, while intuition people tend to seek the meaning in the underlying theory and principles which are manifested in the data.</p>

<h2>Thinking (T) – (F) Feeling</h2>

<blockquote><p>Thinking and feeling are the decision-making functions. Those who prefer thinking tend to decide things from a more detached standpoint, measuring the decision by what seems reasonable, logical, causal, consistent, and matching a given set of rules. Those who prefer feeling tend to come to decisions by associating or empathizing with the situation, looking at it &#8216;from the inside&#8217; and weighing the situation to achieve, on balance, the greatest harmony, consensus and fit, considering the needs of the people involved. - Wikipedia</p></blockquote>

<p>Therefore thinkers are often perceived to have a bigger ego.</p>

<h2>Judging (J) –  (P) Perception</h2>

<p>Judging and Perception represent the lifestyles you choose. People who prefer perception are generally more passive, seeking to understand the world as it is, while judging people prefer to act, to make a difference.</p>

<h2>About My Types</h2>

<p>I was an ENFP hence I was more of a product manager / program manager type of guy. Oh, and many passionate revolutionaries are of this type.</p>

<p>Since I realized I was not satisfied with that, therefore I changed myself from E to I and from F to T, and now I am an INTP.</p>

<p>By becoming an INTP I find myself in the same group with most scientists and philosophers, but I don&#8217;t like it as of this moment.</p>

<p>Thus I am becoming an INTJ.</p>

<p>Simply put, I prefer to become more like Elon Musk than Larry Page or Sergey Brin or Albert Einstein.</p>

<h2>Final Notes</h2>

<p>MBTI is just a method to group people into sub-groups. Don&#8217;t take it too seriously.</p>

<p>After all, there are only 16 groups, and even if you are in the rarest group, or you may prefer, the most elite group, 1% * 6 billion is still a very large number.</p>

<p>And there are still people like me who are well aware of the system and are willing to hack their own minds, and are capable of taking actions to change their types on demand and have succeeded.</p>

<p>Take that.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hacker News]]></title>
    <link href="http://forresty.com/blog/2012/12/08/hacker-news/"/>
    <updated>2012-12-08T12:48:00+08:00</updated>
    <id>http://forresty.com/blog/2012/12/08/hacker-news</id>
    <content type="html"><![CDATA[<blockquote><p>Germany has declared war on Russia. Swimming in the afternoon. -Franz Kafka&#8217;s diary entry of August 2, 1914</p></blockquote>

<p>When you are seeking to understand the fundamental logics and reasons of this world, sooner or later you&#8217;ll come to realize that daily trivial matters are of no importance at all.</p>

<p>Thus I abandoned a private experimental Hacker News iOS app roughly 5 months ago, because I realized that I don&#8217;t want to pay that much attention to news any more.</p>

<p>It&#8217;s now open source on GitHub <a href="https://github.com/forresty/Hackish">https://github.com/forresty/Hackish</a>.</p>

<p>Mind you, the code sucks. It stinks, it smells. I haven&#8217;t touched a single line of Objective-C after that (except spending half an hour to clean it up last night), but I believe I can now easily write at least 5 times better in less than 1/3 of the time.</p>

<p>But still, since I&#8217;ve seen a lot of pretentious people pretending that they know how to write iOS code, I think what the hell, opening this shit up to the world might not make it a worse place.</p>

<p>If you go read it and think &#8220;LOL, this guy sucks&#8221;, then thank you, you motivate me.</p>

<p>I tried to be humble, but this world seems to ignore humble people.</p>

<p>So I say fuck this shit, I&#8217;d better be hated or laughed at than be ignored.</p>

<p>Come judge me.</p>

<p>UPDATE: corrections on Kafka&#8217;s diary. BTW for a good example of well-written iOS client code, check out Cheddar by Sam Soffes <a href="https://github.com/nothingmagical/cheddar-ios">https://github.com/nothingmagical/cheddar-ios</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[sweet tweets]]></title>
    <link href="http://forresty.com/blog/2012/12/07/sweet-tweets/"/>
    <updated>2012-12-07T21:48:00+08:00</updated>
    <id>http://forresty.com/blog/2012/12/07/sweet-tweets</id>
    <content type="html"><![CDATA[<blockquote><p>I hate to break it to you, but your product does not depend on elegance of code. It depends on positioning and marketing. Embrace that. - @holman</p></blockquote>

<p><a href="https://twitter.com/holman/status/277004349333467136">https://twitter.com/holman/status/277004349333467136</a></p>

<blockquote><p>Why are engineer founders are on the rise? Businessmen create that which has worked in the past. Engineers create that which has never been. - @kneath</p></blockquote>

<p><a href="https://twitter.com/kneath/status/273869571360956416">https://twitter.com/kneath/status/273869571360956416</a></p>

<blockquote><p>Internet comments would be great if you could filter them by “Has this user accomplished anything? Anything at all?” - @holman</p></blockquote>

<p><a href="https://twitter.com/holman/status/272800396802670592">https://twitter.com/holman/status/272800396802670592</a></p>

<blockquote><p>$PATH is dependency injection for Unix. It doesn’t need to be complicated. - @sstephenson</p></blockquote>

<p><a href="https://twitter.com/sstephenson/status/270673707389841408">https://twitter.com/sstephenson/status/270673707389841408</a></p>

<blockquote><p>What if you designed a web framework around the error messages displayed to developers? - @kneath</p></blockquote>

<p><a href="https://twitter.com/kneath/status/263062829375041536">https://twitter.com/kneath/status/263062829375041536</a></p>

<p>There are reasons why companies like GitHub and 37signals are awesome.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[meditation]]></title>
    <link href="http://forresty.com/blog/2012/12/07/meditation/"/>
    <updated>2012-12-07T20:58:00+08:00</updated>
    <id>http://forresty.com/blog/2012/12/07/meditation</id>
    <content type="html"><![CDATA[<p>If you need meditation in order to clear your mind, that&#8217;s called finding focus / getting into the zone.</p>

<p>If you need meditation because you feel a little bit burnt out, that&#8217;s called resting.</p>

<p>If you need meditation because you don&#8217;t know what to do, that&#8217;s called thinking.</p>

<p>If you have work to do but you think you need to meditate, that&#8217;s called procrastination.</p>

<p>If you fell asleep during meditation, that&#8217;s called sleeping.</p>

<p>Steve Jobs practiced meditation, Elon Musk may have done drugs, super heroes in Ayn Rand&#8217;s books smoke. They might helped, but they are not why those people are successful.</p>

<p>Just stop pretending and start to get things done.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[INTP]]></title>
    <link href="http://forresty.com/blog/2012/12/06/intp/"/>
    <updated>2012-12-06T14:38:00+08:00</updated>
    <id>http://forresty.com/blog/2012/12/06/intp</id>
    <content type="html"><![CDATA[<p>Just took another MBTI test, it seems now I am an INTP.</p>

<p>Apparently I&#8217;ve changed a lot since last time (roughly 3~4 years ago) I took the test I was an ENFP. I think it&#8217;s likely that I&#8217;ve had stayed ENFPish till last year or so (while recently I gradually moved from Extraversion to Introversion and Feeling to Thinking).</p>

<p>But I might want myself to be an INTJ, since INTJs are more on the &#8220;doer&#8221; side while INTPs are more on the &#8220;thinker&#8221; side.</p>

<p>So, how can I make myself move towards INTJ?</p>

<p>Maybe keep &#8220;thinking&#8221; how is not the right answer, right? ;)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Introducing dotjs-pow]]></title>
    <link href="http://forresty.com/blog/2012/12/04/introducing-dotjs-pow/"/>
    <updated>2012-12-04T14:06:00+08:00</updated>
    <id>http://forresty.com/blog/2012/12/04/introducing-dotjs-pow</id>
    <content type="html"><![CDATA[<p>I just released a small piece of code called <a href="https://github.com/forresty/dotjs-pow">dotjs-pow</a> on GitHub, before I tell you what it is, let me tell you a short story first.</p>

<p>You see, recently, I read a lot of books. I bought most of them on <a href="http://amazon.cn">amazon.cn</a> since you know, dead-tree versions of Chinese books are dirt cheap.</p>

<p>And also, there is this Chinese site <a href="http://douban.com">douban.com</a>, which has generally pretty reliable Chinese book ratings and reviews, and you know what, they have some nice APIs too!</p>

<p>Since I find myself constantly switching Safari tabs between pages from amazon.cn and douban.com, I started to think that how can I make this easier.</p>

<p>Initially, I thought about building a Safari extension, but it is not an elegant solution.</p>

<p>Then I found this awesome piece of code called <a href="https://github.com/defunkt/dotjs">dotjs</a> by GitHub CEO(!) Chris Wanstrath (a.k.a. defunkt), basically it lets you run a custom js file located in your <code>~/.js</code> each time you visit a site.</p>

<p>&#8220;Yes!&#8221;, I think, so in a hurry I installed it (albeit I have to install <a href="https://github.com/wfarr/dotjs.safariextension">dotjs.safariextension</a> as well since defunkt was a Chrome guy) and put following code in my <code>~/.js/amazon.cn.js</code> to put it to a test:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">url</span> <span class="o">:</span> <span class="s1">&#39;http://api.douban.com/book/subjects?alt=json&amp;q=9787533935030&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">type</span> <span class="o">:</span> <span class="s1">&#39;get&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">dataType</span> <span class="o">:</span> <span class="s1">&#39;JSON&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">success</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;yay!&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">failure</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;meh&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>And points my Safari to amazon.cn. As you might have already guessed, I saw this in Safari console:</p>

<p><img src="http://forresty.com/images/Access-Control-Allow-Origin.png" alt="Access-Control-Allow-Origin.png" /></p>

<p>Hmm. Typical.</p>

<p>Since I don&#8217;t control either amazon.cn or douban.com, one solution is that I build an API proxy for api.douban.com.</p>

<p>It&#8217;s quite easy to do so using Sinatra and HTTParty:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;httparty&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">disable</span> <span class="ss">:protection</span>
</span><span class='line'>
</span><span class='line'><span class="n">get</span> <span class="s1">&#39;/api/douban/book/isbn/:isbn&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">headers</span> <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json; charset=utf-8&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">HTTParty</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://api.douban.com/book/subjects?alt=json&amp;q=</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:isbn</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">body</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>But of course I don&#8217;t want to put the proxy on the Internet! So am I going to run yet another service on my localhost? Hmm, I don&#8217;t like ugly hacks.</p>

<p>Then I realized <code>djsd</code> used by dotjs is just a static file server, and since I already have a Rack-compliant <a href="https://github.com/37signals/pow">Pow</a> running on my machine (as many Rubyists do), why not just build a Pow powered dotjs server, which can also be used to bypass cross-site security protections as well?</p>

<p>Thus <a href="https://github.com/forresty/dotjs-pow">dotjs-pow</a> was born.</p>

<p>And with following codes in my <code>~/.js/amazon.cn.js</code>, job&#8217;s done.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">trim</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s+|\s+$/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isbnize</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/,.+$/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">trim</span><span class="p">();</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// http://stackoverflow.com/questions/1408289/best-way-to-do-variable-interpolation-in-javascript</span>
</span><span class='line'><span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">supplant</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/{([^{}]*)}/g</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">o</span><span class="p">[</span><span class="nx">b</span><span class="p">];</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">typeof</span> <span class="nx">r</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">r</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span> <span class="o">?</span> <span class="nx">r</span> <span class="o">:</span> <span class="nx">a</span><span class="p">;</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;b:contains(&quot;ISBN:&quot;)&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">isbn</span> <span class="o">=</span> <span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nextSibling</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">isbnize</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">url</span> <span class="o">:</span> <span class="s1">&#39;http://dotjs-pow.dev/api/douban/book/isbn/&#39;</span> <span class="o">+</span> <span class="nx">isbn</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">type</span> <span class="o">:</span> <span class="s1">&#39;get&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">dataType</span> <span class="o">:</span> <span class="s1">&#39;JSON&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">success</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">numRaters</span> <span class="o">=</span> <span class="nx">json</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;gd:rating&#39;</span><span class="p">][</span><span class="s1">&#39;@numRaters&#39;</span><span class="p">];</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">rating</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">json</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;gd:rating&#39;</span><span class="p">][</span><span class="s1">&#39;@average&#39;</span><span class="p">]);</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nx">json</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;link&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;@href&#39;</span><span class="p">];</span>
</span><span class='line'>        <span class="c1">// ratings: 7.9 =&gt; 4_0, 8.5 =&gt; 4_5, 8.6 =&gt; 5_0</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">stars_1</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">rating</span> <span class="o">+</span> <span class="mf">1.4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">stars_2</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">rating</span> <span class="o">+</span> <span class="mf">1.4</span><span class="p">)</span> <span class="o">===</span> <span class="nx">stars_1</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;span class=&quot;swSprite s_star_{stars_1}_{stars_2}&quot; title=&quot;{numRaters} ratings&quot;&gt;&lt;/span&gt;&lt;span&gt;(&lt;a href=&quot;{link}&quot;&gt;{rating}&lt;/a&gt;)&lt;/span&gt;&#39;</span><span class="p">.</span><span class="nx">supplant</span><span class="p">({</span>
</span><span class='line'>          <span class="nx">stars_1</span> <span class="o">:</span> <span class="nx">stars_1</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">stars_2</span> <span class="o">:</span> <span class="nx">stars_2</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">numRaters</span> <span class="o">:</span> <span class="nx">numRaters</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">rating</span> <span class="o">:</span> <span class="nx">rating</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">link</span> <span class="o">:</span> <span class="nx">link</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="nx">html</span><span class="p">).</span><span class="nx">insertAfter</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#btAsinTitle&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">parentNode</span><span class="p">);</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nx">failure</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;something was wrong.&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Check it out in action (please forgive me, I suck at styling web pages&#8230;):</p>

<p><img src="http://forresty.com/images/amazon.cn-douban-book-api.png" alt="amazon.cn-douban-book-api.png" /></p>

<p>Oh, of course I have to use <a href="https://github.com/forresty/dotjs-pow.safariextension">a modified version</a> of dotjs.safariextension since I changed the server address from http://localhost:3131 to http://dotjs-pow.dev.</p>

<p>The full source code of app.rb (that is, the dotjs-pow server) is as following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/bin/env ruby</span>
</span><span class='line'>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;bundler&quot;</span>
</span><span class='line'><span class="no">Bundler</span><span class="o">.</span><span class="n">require</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># sometimes, it is more fun to do it without protection</span>
</span><span class='line'><span class="n">disable</span> <span class="ss">:protection</span>
</span><span class='line'>
</span><span class='line'><span class="n">get</span> <span class="s1">&#39;/js/:js_file&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">headers</span> <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/javascript; charset=utf-8&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s2">&quot;~/.js/</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:js_file</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span> <span class="k">rescue</span> <span class="s2">&quot;{}&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">get</span> <span class="s1">&#39;/api/douban/book/isbn/:isbn&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">headers</span> <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json; charset=utf-8&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">HTTParty</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://api.douban.com/book/subjects?alt=json&amp;q=</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:isbn</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">body</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you are a hopeless nerd like me, you might want to check it out yourself, visit <a href="https://github.com/forresty/dotjs-pow">dotjs-pow on GitHub</a> now.</p>

<p>BTW, <a href="http://forresty.com/hire">I am currently available for hire</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Prototypal]]></title>
    <link href="http://forresty.com/blog/2012/12/03/prototypal/"/>
    <updated>2012-12-03T00:59:00+08:00</updated>
    <id>http://forresty.com/blog/2012/12/03/prototypal</id>
    <content type="html"><![CDATA[<p>So yesterday I decided it&#8217;s time for me to stop procrastinating and start to learn JavaScript seriously.</p>

<p>(Yes, judge me, I am a Ruby guy but I suck at JavaScript!)</p>

<p>So I picked up this wonderful little book named <em>JavaScript: The Good Parts</em> by the JavaScript guru Douglas Crockford and started to read it through in depth (Yes I read it twice before but never in depth). It was an immense amount of fun I must admit.</p>

<!-- more -->


<p>So just now I was trying to understand why the fuck following codes work:</p>

<h3>Code Sample #1</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">method</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">func</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nb">Object</span><span class="p">.</span><span class="nx">method</span><span class="p">(</span><span class="s1">&#39;superior&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">method</span> <span class="o">=</span> <span class="nx">that</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
</span><span class='line'>  <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">method</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>I only have a vague idea about prototype chaining in JavaScript, that&#8217;s when an object failed to find a property in itself it will start to look it up in its prototype, and prototype&#8217;s prototype and then all the way up to the top.</p>

<p>The codes above implements a <code>superior</code> function which mimics the <code>super</code> in OO world on the object prototype thus enables it on ALL objects, thus making following codes possible:</p>

<h3>Code Sample #2</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">father</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">spec</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>  <span class="nx">that</span><span class="p">.</span><span class="nx">get_name</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">spec</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">son</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">spec</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="nx">father</span><span class="p">(</span><span class="nx">spec</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">super_name</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">superior</span><span class="p">(</span><span class="s1">&#39;get_name&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">that</span><span class="p">.</span><span class="nx">get_name</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="s1">&#39;proud son of &#39;</span> <span class="o">+</span> <span class="nx">super_name</span><span class="p">();</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">afu</span> <span class="o">=</span> <span class="nx">father</span><span class="p">({</span><span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;afu&#39;</span><span class="p">});</span>
</span><span class='line'><span class="nx">afu</span><span class="p">.</span><span class="nx">get_name</span><span class="p">();</span>
</span><span class='line'><span class="c1">// afu</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">afu_junior</span> <span class="o">=</span> <span class="nx">son</span><span class="p">({</span><span class="nx">name</span> <span class="o">:</span> <span class="s1">&#39;afu&#39;</span><span class="p">});</span>
</span><span class='line'><span class="nx">afu_junior</span><span class="p">.</span><span class="nx">get_name</span><span class="p">();</span>
</span><span class='line'><span class="c1">// proud son of afu</span>
</span></code></pre></td></tr></table></div></figure>


<p>I can easily understand the Code Sample #2. The <code>superior()</code> call seems really natural, and that&#8217;s just the way APIs / libraries are supposed to work, right?</p>

<p>So I head back to Code Sample #1 to try to understand how the magic happened behind the scenes.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">method</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">func</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>This part is easy. It defines a <code>method</code> function on the function prototype so all functions are benefitted from it, any function calls the <code>method()</code> gets its prototype assigned a function as a property. So far so good.</p>

<p>But why <code>Object.method()</code> works??</p>

<p>Well, the answer, unlike the stupid poor me, you might already knew, is that the <code>Object</code> is a function.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">typeof</span> <span class="nb">Object</span> <span class="o">===</span> <span class="kd">function</span>
</span><span class='line'><span class="c1">// true</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// in case you are wondering, this is truthy as well:</span>
</span><span class='line'><span class="k">typeof</span> <span class="nb">Function</span> <span class="o">===</span> <span class="kd">function</span>
</span><span class='line'><span class="c1">// true</span>
</span></code></pre></td></tr></table></div></figure>


<p>I felt my brain had just exploded. Wow. So I did some more experiments:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// So, following expressions are all truthy:</span>
</span><span class='line'><span class="k">typeof</span> <span class="nb">Function</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span>
</span><span class='line'><span class="k">typeof</span> <span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span>
</span><span class='line'><span class="k">typeof</span> <span class="nb">Object</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span>
</span><span class='line'><span class="k">typeof</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span>
</span><span class='line'><span class="k">typeof</span> <span class="p">{}</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// And more fun:</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">func</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">obj</span><span class="p">.</span><span class="nx">hello</span><span class="p">;</span>
</span><span class='line'><span class="c1">// undefined</span>
</span><span class='line'>
</span><span class='line'><span class="nx">func</span><span class="p">.</span><span class="nx">hello</span><span class="p">;</span>
</span><span class='line'><span class="c1">// undefined</span>
</span><span class='line'>
</span><span class='line'><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hello</span> <span class="o">=</span> <span class="s1">&#39;sweetie&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">obj</span><span class="p">.</span><span class="nx">hello</span><span class="p">;</span>
</span><span class='line'><span class="c1">// sweetie</span>
</span><span class='line'><span class="nx">obj</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">;</span>
</span><span class='line'><span class="c1">// { superior: [Function], hello: &#39;sweetie&#39; }</span>
</span><span class='line'>
</span><span class='line'><span class="nx">func</span><span class="p">.</span><span class="nx">hello</span><span class="p">;</span>
</span><span class='line'><span class="c1">// sweetie</span>
</span><span class='line'><span class="nx">func</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">;</span>
</span><span class='line'><span class="c1">// { [Function: Empty] method: [Function] }</span>
</span><span class='line'><span class="nx">func</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">;</span>
</span><span class='line'><span class="c1">// { superior: [Function], hello: &#39;sweetie&#39; }</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Sneak peek into Object and Function using Safari (courtesy of my friend @Leaskh):</span>
</span><span class='line'><span class="nb">Object</span><span class="p">;</span>
</span><span class='line'><span class="c1">// function Object() {</span>
</span><span class='line'><span class="c1">//   [native code]</span>
</span><span class='line'><span class="c1">// }</span>
</span><span class='line'>
</span><span class='line'><span class="nb">Function</span><span class="p">;</span>
</span><span class='line'><span class="c1">// function Function() {</span>
</span><span class='line'><span class="c1">//   [native code]</span>
</span><span class='line'><span class="c1">// }</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// This is interesting:</span>
</span><span class='line'><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
</span><span class='line'><span class="c1">// { superior: [Function], hello: &#39;sweetie&#39; }</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Yes they are all truthy:</span>
</span><span class='line'><span class="nx">obj</span><span class="p">.</span><span class="nx">__proto__</span> <span class="o">===</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
</span><span class='line'><span class="nx">func</span><span class="p">.</span><span class="nx">__proto__</span> <span class="o">===</span> <span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
</span><span class='line'><span class="nx">func</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">.</span><span class="nx">__proto__</span> <span class="o">===</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>So basically, hacking a <code>method()</code> function onto <code>Function.prototype</code> enables it for all functions including <code>Object</code>, and hacking a <code>superior()</code> function with invocation of <code>method()</code> on <code>Object</code> hacks it onto <code>Object.prototype</code> thus enables it for all objects.</p>

<p>So, the Code Sample #1 is exactly the same as:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">superior</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">method</span> <span class="o">=</span> <span class="nx">that</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
</span><span class='line'>  <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">method</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Per the <code>this</code> binding rules, this line in Sample Code #2</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">super_name</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">superior</span><span class="p">(</span><span class="s1">&#39;get_name&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>retrieves the <code>get_name()</code> function in <code>that</code> which carefully protects <code>that</code> in its closure and is ready to be called with <code>arguments</code>. Neat!</p>

<p>So I think I just figured out some of the most basic ideas about why JavaScript is called a prototypal language and how its prototype chaining really works. (Right? Right??)</p>

<p>This reminds me the moment of ecstasy when I first understood Ruby object / class / singleton-class hierarchies. Aha moments like this is one of the reasons why it is so fascinating to be working in this field.</p>

<p>Yes, my brain hurts now and I need to rest. And yes I &lt;3 programming.</p>

<p>TL;DR:</p>

<p>TIL in JavaScript functions are objects, and Object is a function.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Serious]]></title>
    <link href="http://forresty.com/blog/2012/11/20/serious/"/>
    <updated>2012-11-20T11:16:00+08:00</updated>
    <id>http://forresty.com/blog/2012/11/20/serious</id>
    <content type="html"><![CDATA[<p>Last night, when I was having dinner with my girlfriend at a restaurant, a waiter accidentally dropped a receipt to the floor when passing by our table.</p>

<p>I know this is just a little thing and probably had already happened to you before. But in this case, what would you do?</p>

<p>Well. For me, I picked it up, took a look at it, then gave it back to the waiter then standing behind a counter not far away.</p>

<p>And I thought that was the end of the story.</p>

<p>But one hour later, we found out that my girlfriend had left her cell phone at the restaurant, and apparently someone was trying to reach us in order to return the phone.</p>

<p>I rushed back to the restaurant and found the very same waiter waiting for me, smiling, and gave the phone back to me.</p>

<p>To remind you, this is China, a place where when you&#8217;ve lost something you are not likely to get it back.</p>

<p>I was very happy.</p>

<p>Then I recalled yet another story happened to me one night several weeks ago.</p>

<p>I was taking a walk near my apartment, and all of a sudden an old man tripped and fell onto the floor. I rushed forward without a thought to check on him.</p>

<p>Luckily he was not hurt at all, and a bit surprisingly, he was happy seeing me coming.</p>

<p>Later I remembered helping elder people who accidentally fell in China might cost you a fortune.</p>

<p>Then I thought about a <a href="http://book.douban.com/review/1133203/">review</a> of <a href="http://book.douban.com/subject/4729583/">野火集</a> I read on Douban yesterday, it was the top review on the book on Douban. To quote some of her text:</p>

<p>「既然关心除了关心便没有其他的价值，不会让我快乐，不会让我安详，不会让我感悟，甚至鲜血也已不能带来恐慌，哭泣也已不能带来动容，迫害也已不能带来愤怒，你说，我关心它们还有什么意义？」</p>

<p>「于是我继续关心自己的一切，以及自己以外的一切八卦。」</p>

<p>I want to tell you that you are wrong. It&#8217;s totally okay to be selfish, but it&#8217;s not ok to be aloof.</p>

<p>If you really care about yourself, you will not be satisfied by merely stay away from everything you don&#8217;t like.</p>

<p>Because there is always something small you can do everyday to make this world a better place, and who knows when what you do will come back to you and light up your day.</p>

<p>As time goes by I find myself getting more and more serious about everything. Why so serious, you may ask.</p>

<p>Because I care.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[anti-social at its best]]></title>
    <link href="http://forresty.com/blog/2012/11/17/anti-social-at-its-best/"/>
    <updated>2012-11-17T19:52:00+08:00</updated>
    <id>http://forresty.com/blog/2012/11/17/anti-social-at-its-best</id>
    <content type="html"><![CDATA[<p>I have a dream.</p>

<p>A wild, seemly unrealistic dream.</p>

<p>For the past few months, though it seemed I was making progress everyday, the dream is still far far away.</p>

<p>So I think I should make plans. Plans and actions make dreams come true, so my dream would become a goal.</p>

<p>I wrote down the goal and its dependencies using the DOT language, then I generated a huge colored tree-like digraph as desktop background with Graphviz.</p>

<p>The parts I&#8217;ve accomplished or achieved are in green color, those I am working on are in light-green, those I should pay more attentions are in pink or red.</p>

<p>Okay now it&#8217;s more like a game.</p>

<p>Next I started to simplify my life aggressively.</p>

<p>I made a list of stuffs I can&#8217;t live without, and started to think how to shorten the list and improve it.</p>

<p>I made and a list of stuffs I really don&#8217;t need, and started to get rid of them.</p>

<p>Okay now everything seems to be in proper order.</p>

<p>I realized just as there is meta-programming, there is meta-living. Knowledge-wise, information on Twitter is the most fragmented and disorganized, so let&#8217;s go meta-level, to blogs, to books, to code-reading, to actually working on the problems.</p>

<p>Okay now I understand things better.</p>

<p>I simplified my daily schedule, I reduced the number of websites I visit everyday, I pay fewer attentions to news, I unfollowed a lot of people.</p>

<p>Okay now I have a peaceful mind.</p>

<p>And now I am happy.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Nikola Tesla on Thomas Edison]]></title>
    <link href="http://forresty.com/blog/2012/10/27/nikola-tesla-on-thomas-edison/"/>
    <updated>2012-10-27T16:17:00+08:00</updated>
    <id>http://forresty.com/blog/2012/10/27/nikola-tesla-on-thomas-edison</id>
    <content type="html"><![CDATA[<p>Remember this famous quote from Thomas Edison describing his timeless efforts on trying to invent the first commercially practical light bulb?</p>

<blockquote><p>&#8220;I have not failed. I&#8217;ve just found 10,000 ways that won&#8217;t work.&#8221;</p></blockquote>

<p>Well, found this on Wikipedia:</p>

<blockquote><p> When Thomas Edison died in 1931, Tesla contributed the only negative opinion to the New York Times, buried in an extensive coverage of Edison&#8217;s life:</p>

<p>He had no hobby, cared for no sort of amusement of any kind and lived in utter disregard of the most elementary rules of hygiene  &#8230; His method was inefficient in the extreme, for an immense ground had to be covered to get anything at all unless blind chance intervened and, at first, I was almost a sorry witness of his doings, knowing that just a little theory and calculation would have saved him 90 percent of the labor. But he had a veritable contempt for book learning and mathematical knowledge, trusting himself entirely to his inventor&#8217;s instinct and practical American sense.</p></blockquote>

<p>Really, I can&#8217;t say which is better, but this particular difference between engineering-types and business-types is very interesting indeed.</p>

<p>Wikipedia links:</p>

<ul>
<li><a href="http://en.wikipedia.org/wiki/Nikola_Tesla">Nikola Tesla</a></li>
<li><a href="http://en.wikipedia.org/wiki/History_of_the_light_bulb#History_of_the_light_bulb">History of the light bulb</a></li>
<li><a href="http://en.wikipedia.org/wiki/Thomas_Edison">Thomas Edison</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Sociopath]]></title>
    <link href="http://forresty.com/blog/2012/10/25/sociopath/"/>
    <updated>2012-10-25T17:14:00+08:00</updated>
    <id>http://forresty.com/blog/2012/10/25/sociopath</id>
    <content type="html"><![CDATA[<p>Just saw this on quora:</p>

<p><a href="http://www.quora.com/Ayn-Rand/Why-do-so-many-engineering-types-with-poor-social-skills-think-Ayn-Rand-is-great">http://www.quora.com/Ayn-Rand/Why-do-so-many-engineering-types-with-poor-social-skills-think-Ayn-Rand-is-great</a></p>

<p>It certainly makes these <strong>people people</strong> feel good by denouncing us sociopaths.</p>

<p>Well, I <strong>love</strong> <em>Atlas Shrugged</em> and <em>The Fountainhead</em>, though I don&#8217;t quite like her, thus the title of the question doesn&#8217;t really apply to me. It&#8217;s just seeing the very wording of this question and the top answer reminds me how much I don&#8217;t like most people.</p>

<p>I am a sociopath, and I am quite comfortable with it.</p>

<p>I really wish I can block topics such as <strong>People Skills</strong> on Quora.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rainy day]]></title>
    <link href="http://forresty.com/blog/2012/10/22/rainy-day/"/>
    <updated>2012-10-22T14:39:00+08:00</updated>
    <id>http://forresty.com/blog/2012/10/22/rainy-day</id>
    <content type="html"><![CDATA[<p>I never learnt to handle rainy days well.</p>

<p>Woke up in the morning after a late night&#8217;s work, only to find it raining outside, like today.</p>

<p>Check the time, looks like I&#8217;ve already got 8 hours of sleep. But I don&#8217;t feel energized, or fully recharged like I should. Not at all. The colors outside the window are not right: instead of a bright blue sky, white clouds, green lawn and trees, everything is gray. Colorless. No happy kids running around, no dogs or cats chasing each other, no birds singing and dancing with enlightenment. Silence.</p>

<p>The lower temperature, the lack of energy in the air, the dim light, the monotone of raindrops falling make me feel grumpily at ease. But I don&#8217;t want to rest, I want to sit at my desk working. I don&#8217;t come to this world to just stay lying in bed, I am here to make a dent in the universe.</p>

<p>I find myself lack of appetite. I should&#8217;ve forced myself to eat more this morning.</p>

<p>Storm is much better. Staying inside during stormy weather makes you feel happy, because you are glad that unlike other creatures out in the wild, you have a nice shelter with eletricity and hot water to keep you safe. It makes you feel strong.</p>

<p>But on rainy day I feel weak. And I hate feeling weak.</p>

<p>I decided to get out and go for a walk in the nearby Century Park, and it turned out to be a bad decision. It only makes me feel smaller and weaker. How can you feel stronger as a man by being forced to walk a long way in the tall trees, without man-made concrete buildings insight in this cold, dark and damp afternoon?</p>

<p>I rushed back home to a big cup of hot tea.</p>

<p>Maybe I should just learn to pay more attentions to weather forecasts?</p>

<p>But even if I know it is going to rain, what am I going to do about it?</p>

<p>I don&#8217;t want to be controlled by weather, or other people, or anything. I don&#8217;t want to be controlled at all.</p>

<p>So next time I woke up to such weather, I shall force myself to leave my bed immediately, get the music of my morning playlist playing out loud, turn on as many lights as possible, make myself a cup of hot chocolate + coffee and take a hot shower. It shall do the trick.</p>

<p>You can try, but you will never defeat me.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cassandra and Ruby]]></title>
    <link href="http://forresty.com/blog/2012/10/18/cassandra-and-ruby/"/>
    <updated>2012-10-18T11:36:00+08:00</updated>
    <id>http://forresty.com/blog/2012/10/18/cassandra-and-ruby</id>
    <content type="html"><![CDATA[<p>I&#8217;ve been working on a project that requires the usage of Cassandra and Ruby for some time already, and the process is at the same time quite painfully slow and rewarding for me.</p>

<!-- more -->


<p>To be honest, working with Cassandra using Ruby is not a pleasant experience, especially for a not-so-experienced programmer like me. IMHO the main problems are:</p>

<ol>
<li><p>Cassandra itself, is not so wonderful as promised. Sitting on the AP side of the CAP theorem, that is, unlike traditional RDBMSs or newer NoSQL breeds such as MongoDB and Redis, Cassandra is always available and partitioning-tolerant, while sacrificing consistency. Being open-sourced by Facebook and later adopted by Twitter and Reddit etc, it solves very specific problems for them: inbox search for Facebook, real-time analytics for Twitter, and persistent cache for Reddit. THEY DON&#8217;T USE IT AS MAIN STORAGE ENGINES AND THERE ARE NOT MANY PEOPLE IN THE WILD USING IT. That alone can tell something.</p></li>
<li><p>Cassandra is not very Ruby-friendly, or better put, there is not a huge community of Ruby users playing with it, perhaps due to somewhat conflicts in philosophy? Unlike widely available options of open source client libraries for other storage engines, most notably ActiveRecord from Rails for traditional RDBMS, or Mongoid for MongoDB, there are only low-level libraries such as thrift_client gem and cassandra gem by Twitter, the only good high-level library I can find is data-axle&#8217;s fork of cassandra_object, which only has 28 watchers on GitHub. So in that sense, I do feel lonely a little bit, good thing is I&#8217;ve already gotten used to that.</p></li>
</ol>


<p>Well, this is not a post about the downside of using Cassandra with Ruby, so I&#8217;d just stop the complaint. If I am really as good at coding and hacking as I imagined myself to be, I would be much happier. So I only have myself to blame.</p>

<p>So back to the main topic.</p>

<p>Thrift interface is Cassandra&#8217;s lowest level API interface, it&#8217;s quite like the ProtocolBuffer from Google or the (seemingly more sassy) MessagePack. Though CQL is later added as an interface option, the CQL channel is actually built upon thrift interface - that is, every time you execute a CQL query against a Cassandra node, your query is packaged as a Thrift RPC call to that node, and you get your results back as a packet of binary thrift formatted data. Performance-wise, various people have done experiments and the difference between raw thrift calls and cql queries is not apparent, which is quite understandable. Besides Thrift, there used to be an alternative RPC interface based on Avro which is a bit similar to Thrift, the reasons why it was introduced in the first place and why later got dropped I never bother myself to look into.</p>

<p>Since Cassandra is written in Java, so naturally its Thrift server is implemented in Java. So typically when you use Cassandra with Ruby, you are going down on this route:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cassandra gem (from Twitter, in Ruby) ---&gt;
</span><span class='line'>thrift_client gem (Twitter, simply a wrapper around thrift gem, Ruby) ---&gt;
</span><span class='line'>thrift gem (from the Thrift team, part of Thrift source code, Ruby & C) ---&gt;
</span><span class='line'>[TCP/IP or Unix socket, possibly over the inter-webz] ---&gt;
</span><span class='line'>Thrift server (from the Cassandra team, in Java) ---&gt;
</span><span class='line'>Cassandra internal API (Cassandra, Java) ---&gt;
</span><span class='line'>Cassandra (hooray!)</span></code></pre></td></tr></table></div></figure>


<p>Well, what I am doing (and a bunch of other people) is throwing on top of these another layer, the data-axle&#8217;s fork of cassandra_object, which is modeled based on the awesome ActiveModel project introduced in Rails 3 and uses the cassandra gem from Twitter internally, and then trying to tame it to my specific needs, and hack yet another layer of business logic on top of it. So you can imagine when things went wrong, I&#8217;d be forced to go down each layer trying to figure out what the fuck is going on. Since there is no a huge community, I am thankful that my hair is short so I don&#8217;t have the risks of getting them pulled off by the irritated me.</p>

<p>But it&#8217;s quite fun and so far I am still enjoying it. I see myself forking the top most layers, learning the hell out of every bit of technical details, and hopefully I don&#8217;t need to go down to the very bottom. During the whole process I am often overwhelmed by a mixed feeling: the hatred towards myself and the regret that I didn&#8217;t become a hard-core tech nerd as early as when I am still in college, and the joy of challenging myself to understand every piece of details down the road and finally getting close to it.</p>

<p>Let see how far it goes.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[smoking and quitting]]></title>
    <link href="http://forresty.com/blog/2012/10/15/smoking-and-quitting/"/>
    <updated>2012-10-15T20:58:00+08:00</updated>
    <id>http://forresty.com/blog/2012/10/15/smoking-and-quitting</id>
    <content type="html"><![CDATA[<p>How long must you have managed not to light up a single cigarette can you consider yourself successfully gotten rid of the addiction to smoking? One month? Three months? Or a year?</p>

<p>For me, as a self-identified soft-core smoker, only one month into forcing myself not to smoke, already have I started to notice a lot of interesting things happening around me.</p>

<p>For a starter, I begin to notice that people are smoking everywhere. Every single one of them. Every single burning cigarette within my eyesight, with every hand holding it. Even the butts on the ground caught my attentions as well. And all the no-smoking signs. And all the ashtrays, in public places or not.</p>

<p>It is quite interesting actually, a bit similar to the effects of weed smoking, but instead of being able to focus on whatever you wanted to see, you only see cigarettes. I don’t know for sure, but maybe a better analogy is when you are so horny all you see is just boobs and naked skins and short skirts. Our brain is such a fascinating device.</p>

<p>My body is telling me that it crave for cigarettes, or more accurately, nicotine. Feeling compelled to do things is not a happy experience. As mortal human, we have already submitted ourselves to the necessity of daily dose of foods and sleep, to be added up with occasional urges of to work, to spend money, to talk to people and to engage in sexual activities. We could argue whether or not we need any more of these mental and physical burdens, to such extent that we create and cast more and more upon ourselves. Can you imagine yourself living without electricity? Without hot water? Without Internet access? To have desires is healthy, to want something new or different is understandable and can be encouraged, but what about to have addictions that we normally or naturally don’t need?</p>

<p>People generally wanted to be free. We improved our technologies on growing foods so the majority of us can be freed from being forced to stay in the field all day, we invented telephones and the Internet so we can be freed from waiting a long time for mail responses and enduring difficulties to access to knowledges, we subverted evil regimes so we can be freed from mandate taxes and bullshits forcefully posed upon us. Our flesh so fragile that we cannot endure the pressure of hundreds of meters under water, yet we’ve sent men to the deepest corners of the oceans with a depth of one hundred times more; metal is more than one thousand times heavier than air, yet we’ve built machines using these stardusts that can carry us up into the air and across the seas.</p>

<p>Occasional smoking is good and relaxing, and it helps you gain and maintain focus during work. Most important characters in Ayn Rand’s books smoke. As a man-worshipping reason-loving atheist, Ayn Rand’s notion that smoking as a symbol of the power of man being able to control fire in finger tips makes much sense to me. But being forced to do so regularly really bugs me. Caffeine too, with it we enjoy a boost of productivity, but without it we fell deeply into a state of grumpy rapidly. Why, don’t we have choices? So is there really such a thing as freewill? Or are these addictions a price we need to pay in order to fully enjoy the advancements we’ve achieved? Can we take off our helmets while conquering the stars and galaxies? Can we?</p>

<p>Being alive is a very unnatural state of existence, since we weren’t born before we arrived in this world as a conscious creature, and we will be dead and remain dead after only a couple of years of living. Time is short, maybe I should not worry so much, so long as I know I love to read books and write down random pseudo-intellectual thoughts such as this, so long as I enjoy a lot reading and writing codes, so long as I understand that there are people to love and things to hate, so long as I see there are so much to learn that perhaps one million lifetimes are not enough, so long as I believe there are a lot to fight for and fight against and I am willing to do that, maybe I should just yield to this seemingly tiny issue?</p>

<p>Or maybe I will never yield.</p>

<p>Should I?</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[三岛由纪夫]]></title>
    <link href="http://forresty.com/blog/2012/08/18/yukio-mishima/"/>
    <updated>2012-08-18T00:39:00+08:00</updated>
    <id>http://forresty.com/blog/2012/08/18/yukio-mishima</id>
    <content type="html"><![CDATA[<p>引自<a href="http://zh.wikipedia.org/zh-cn/%E4%B8%89%E5%B2%9B%E7%94%B1%E7%BA%AA%E5%A4%AB">维基百科</a>：</p>

<p>… 因为过分的保护与管教，构成他贫弱的体质与孤独、甚至有点女性化的人格特质。</p>

<p>三岛的作品在西方世界也有崇高的评价，甚至有人誉称他为<strong>「日本的海明威」</strong>，曾三度入围诺贝尔文学奖，也是著作被翻译成英文等外国语版最多的当代作家。</p>

<p>三岛性好热闹，三教九流之辈无不结交，好美酒，嗜佳肴，高朋满座，列位无虚席，十足是一位花花公子。</p>

<p>1944年第二次世界大战进入最后阶段，日本的处境开始急转直下，三岛由纪夫收到了征兵检查通知，判定是第二乙种体位，需要随时等待征召。</p>

<p>1945年日本在战局中已处于强弩之末的境地，三岛由纪夫终于被征召。首先前往群马县隶属中岛飞行机的兵工厂担任勤劳动员，又马上被正式征入军伍。但因为出发参战之前罹患严重的感冒，军医误诊以为是肺病，结果立刻被遣送回乡。他隶属的部队抵达菲律宾后，在战争中严重折損几乎全军覆没，使得三岛一直认为自己本应为国壮烈牺牲却苟且延活的某种遗憾心态，这可能与他生前激烈的政治主张与最后戏剧性的自杀事件有所关联。</p>

<p>虽然逃过了死亡的命运，但是1945年对于三岛来说是很伤痛的一年，8月15日日本宣布败战投降，四天之后三岛在《文艺文化》的好友莲田善明，以陆军中尉的身份在马来半岛自杀。同年10月23日他的妹妹美津子因伤寒病逝，时年仅17岁。种种打击，使得三岛陷入了人生的低潮。</p>

<p>在川端康成的帮助下，三岛由纪夫终于获得晋身文坛一员的地位，因此对他而言川端是个亦师亦友的重要人物。</p>

<p>早年的三岛始终带有女性的阴柔气质，他厌恶剑道，甚至厌恶剑道砍击时所发出的声音。<strong>1955年，时年30岁的三岛，感受到自己对于美的憧憬，开始上健身房运动及游泳，甚至娴习剑道，以期将自幼以来孱弱的身体改造得强健，让自己不再为肉体的自卑而感到困扰。</strong></p>

<p>1968年诺贝尔文学奖公布得主是川端康成，三岛在第一时间得知得主不是他，脸色铁青一言不发驾着自家跑车上高速公路奔数小时，显见未能得奖对他打击极深。</p>

<hr />

<p>看着电脑屏幕上三岛由纪夫健身前后的体格对比，再低头看着右手手心为了掐灭烟头而留下的两颗水泡，我实在无法不对这个最后敢于用刀切开自己腹肌的男人致以崇高的敬意。</p>

<p>于是默默地打开豆瓣，把《金阁寺》和《假面的告白》加入到本已够长的待读列表。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Notes and Quotes of Cassandra The Definitive Guide, Part-1: Introduction]]></title>
    <link href="http://forresty.com/blog/2012/08/11/cassandra-notes-part-1/"/>
    <updated>2012-08-11T15:11:00+08:00</updated>
    <id>http://forresty.com/blog/2012/08/11/cassandra-notes-part-1</id>
    <content type="html"><![CDATA[<p>Following are the notes I took while reading <a href="http://www.amazon.com/Cassandra-Definitive-Guide-Eben-Hewitt/dp/1449390412"><em>Cassandra The Definitive Guide</em></a>. I am taking a client work that requires me to use Cassandra, so I picked up this book to get familiar with it. It was a good read.</p>

<p>This article is for Chapter 1 the introduction of Cassandra and in general NoSQL. Since I am not an expert in this field, it contains a lot of quotes from the book. In fact, there are so many quotes in this article that many sentences not appear in blockquotes are actually quotes as well. Apologies for that.</p>

<p>I expect myself to write at least one more article on this book, which will be more on the technical details as described in the rest of the book.</p>

<!-- more -->


<h2>History and Background</h2>

<p>Cassandra was <strong>open-sourced by Facebook</strong> in July 2008. It was <strong>strongly influenced by Amazon&#8217;s Dynamo</strong> with its Dynamo-style replication model with <strong>no single point of failure</strong>, but adds a more powerful <strong>&#8220;column family&#8221;</strong> data model.</p>

<p>The code was released as an open source Google Code project in July 2008. During its tenure as a Google Code project in 2008, the code was updateable only by Facebook engineers, and little community was built around it as a result. So in March 2009 it was moved to an Apache Incubator project, and on February 17, 2010 it was voted into a top-level project. Cassandra graduated from the Apache Incubator in March 2010.</p>

<p><strong>How Did Cassandra Get Its Name?</strong></p>

<p>In Greek mythology, Cassandra was the daughter of King Priam and Queen Hecuba of Troy. Cassandra was so beautiful that the god Apollo gave her the ability to see the future. But when she refused his amorous advances, he cursed her such that she would still be able to accurately predict everything that would happen—but no one would believe her. Cassandra foresaw the destruction of her city of Troy, but was powerless to stop it.</p>

<h2>Hierarchical Databases, Relational Databases and NoSQL</h2>

<h3>Hierarchical Databases</h3>

<p><a href="http://en.wikipedia.org/wiki/IBM_Information_Management_System">Information Management System</a> (IMS) by IBM was a very successful hierarchical database which is accessible over a <strong>TCP/IP interface</strong> and is available from a variety of languages. It was difficult to use but nevertheless achieved wide adoption. <strong>IMS was built for use in the Saturn V moon rocket.</strong></p>

<p>Then a new model came along: relational databases. And the rest was history.</p>

<h3>Relational Databases</h3>

<p>Dr. Edgar F.Codd at IBM wrote a paper <strong>&#8220;A Relational Model of Data for Large Shared Data Banks&#8221;</strong> which is still available at <a href="http://www.seas.upenn.edu/~zives/03f/cis550/codd.pdf">http://www.seas.upenn.edu/~zives/03f/cis550/codd.pdf</a> became the foundational work for relational database management systems.</p>

<p>Then a lot of things happened. Then relational databases became a key facet of the modern technology and business landscape.</p>

<h4>SQL as We All Known and Loved</h4>

<p>SQL is a huge part of relational databases. It was first officially adopted as an ANSI standard in 1986, and is powerful for a variety of reasons:</p>

<ul>
<li>great expressive power</li>
<li>easy to use</li>
<li>easy integration with RDBMS</li>
</ul>


<h4>Transactions, ACID-ity, and two-phase commit</h4>

<p>A database transaction is, as Jim Gray puts it, <strong>“a transformation of state” that has the ACID properties</strong> (see <a href="http://research.microsoft.com/en-us/um/people/gray/papers/theTransactionConcept.pdf">http://research.microsoft.com/en-us/um/people/gray/papers/theTransactionConcept.pdf</a>)</p>

<h5>What is ACID?</h5>

<blockquote><p>ACID is an acronym for <strong>Atomic</strong>, <strong>Consistent</strong>, <strong>Isolated</strong>, <strong>Durable</strong>, which are the gauges we can use to assess that a transaction has executed properly and that it was successful:</p>

<p><strong>Atomic</strong></p>

<p>Atomic means “all or nothing”; that is, when a statement is executed, every update within the transaction must succeed in order to be called successful. There is no partial failure where one update was successful and another related update failed. The common example here is with monetary transfers at an ATM: the transfer requires subtracting money from one account and adding it to another account. This operation cannot be subdivided; they must both succeed.</p>

<p><strong>Consistent</strong></p>

<p>Consistent means that data moves from one correct state to another correct state, with no possibility that readers could view different values that don’t make sense together. For example, if a transaction attempts to delete a Customer and her Order history, it cannot leave Order rows that reference the deleted customer’s primary key; this is an inconsistent state that would cause errors if someone tried to read those Order records.</p>

<p><strong>Isolated</strong></p>

<p>Isolated means that transactions executing concurrently will not become entangled with each other; they each execute in their own space. That is, if two different transactions attempt to modify the same data at the same time, then one of them will have to wait for the other to complete.</p>

<p><strong>Durable</strong></p>

<p>Once a transaction has succeeded, the changes will not be lost. This doesn’t imply another transaction won’t later modify the same data; it just means that writers can be confident that the changes are available for the next transaction to work with as necessary.</p></blockquote>

<h5>What&#8217;s wrong with Transactions?</h5>

<p><strong>Transactions are expensive and we might not need it all the time, and it become difficult under heavy load.</strong> When you first attempt to horizontally scale a relational database, you must now account for <em>distributed transations</em>, where the transaction isn’t simply operating inside a single table or a single database, but is spread across multiple systems. <strong>In order to continue to honor the ACID properties of transactions, you now need a transaction manager to orchestrate across the multiple nodes.</strong></p>

<p>In order to account for successful completion across multiple hosts, the idea of a <strong>two-phase commit</strong> (sometimes referred to as “2PC”) is introduced. But then, because two-phase commit locks all associate resources, it is useful only for operations that can complete very quickly.</p>

<p>Two-phase commit blocks, so clients must <strong>wait for a prior transaction to finish before they can access the blocked resource.</strong> After submitting a commit operation, the node will wait for the coordinator to send a commit response (or a rollback response if, say, a different node can’t commit).</p>

<blockquote><p><strong>So in order to account for these shortcomings in two-phase commit of distributed transactions, the database world turned to the idea of compensation.</strong> Compensation, often used in web services, means in simple terms that the operation is immediately committed, and then in the event that some error is reported, a new operation is invoked to restore proper state.</p>

<p>There are a few basic, well-known patterns for compensatory action that architects frequently have to consider as an alternative to two-phase commit. These include <strong>writing off the transaction if it fails, deciding to discard erroneous transactions and reconciling later</strong>. Another alternative is to <strong>retry failed operations later on notification</strong>.</p>

<p><strong>In a reservation system or a stock sales ticker, these are not likely to meet your requirements. For other kinds of applications, such as billing or ticketing applications, this can be acceptable.</strong></p></blockquote>

<p>Gregor Hohpe, a Google architect, wrote a wonderful and often-cited blog entry called <strong>“Starbucks Does Not Use Two-Phase Commit.”</strong> It shows in real-world terms how difficult it is to scale two-phase commit and highlights some of the alternatives that are mentioned here. <a href="http://www.eaipatterns.com/ramblings/18_starbucks.html">http://www.eaipatterns.com/ramblings/18_starbucks.html</a></p>

<h4>Schema</h4>

<p>Schema is how you map your domain objects into a relational model. Since we are application developers, we are all familiar with database schema and Object-Relational Mapping (ORM).</p>

<p>However:</p>

<blockquote><p>… <strong>you are forced to create tables that don’t exist as business objects in your domain</strong>. For example, a schema for a university database might require a Student table and a Course table. <strong>But because of the “many-to-many” relationship here (one student can take many courses at the same time, and one course has many students at the same time), you have to create a join table.</strong> This pollutes a pristine data model, where we’d prefer to just have students and courses. It also forces us to create more complex SQL statements to join these tables together. The join statements, in turn, can be slow.</p>

<p>… <strong>not all schemas map well to the relational model</strong>. One type of system that has risen in popularity in the last decade is the <strong>complex event processing system, which represents state changes in a very fast stream</strong>. It’s often useful to contextualize events at runtime against other events that might be related in order to infer some conclusion to support business decision making. Although event streams could be represented in terms of a relational database, it is an uncomfortable stretch.</p></blockquote>

<h4>Sharding and shared-nothing architecture</h4>

<p>A way to attempt to scale a relational database is to introduce sharding to your architecture.</p>

<blockquote><p>… The idea here is that you <strong>split the data</strong> so that instead of hosting all of it on a single server or replicating all of the data on all of the servers in a cluster, you divide up portions of the data horizontally and host them each separately.</p></blockquote>

<p>There are three basic strategies for determining shard structure:</p>

<blockquote><p><strong>Feature-based shard or functional segmentation</strong></p>

<p>Using this strategy, the data is split not by dividing records in a single table (as in the customer example discussed earlier), but rather by splitting into separate databases the features that don’t overlap with each other very much. For example, at eBay, the users are in one shard, and the items for sale are in another.</p>

<p><strong>Key-based sharding</strong></p>

<p>In this approach, you find a key in your data that will evenly distribute it across shards. A not-so-good example is you could divide your customer records across 26 machines, one for each letter of the alphabet.</p>

<p><strong>Lookup table</strong></p>

<p>In this approach, one of the nodes in the cluster acts as a “yellow pages” directory and looks up which node has the data you’re trying to access. <strong>This has two obvious disadvantages.</strong> The first is that you’ll take a performance hit every time you have to go through the lookup table as an additional hop. The second is that the lookup table not only becomes a bottleneck, but a single point of failure.</p></blockquote>

<p>Sharding could be termed a kind of “shared-nothing” architecture that’s specific to databases. <strong>A shared-nothing architecture is one in which there is no centralized (shared) state, but each node in a distributed system is independent, so there is no client contention for shared resources.</strong> The term was first coined by Michael Stonebraker at University of California at Berkeley in his 1986 paper “The Case for Shared Nothing.”</p>

<p>Shared Nothing was more <strong>recently popularized by Google</strong>, which has written systems such as its Bigtable database and its MapReduce implementation that do not share state, and are therefore capable of <strong>near-infinite scaling</strong>. <strong>The Cassandra database is a shared-nothing architecture</strong>, as it has no central controller and no notion of master/slave; all of its nodes are the same.</p>

<h3>NoSQL</h3>

<p>Why NoSQL?</p>

<p>Let&#8217;s have a look at how we typically address relational database scaling problems:</p>

<blockquote><p>We typically address these problems in one or more of the following ways, sometimes in this order:</p>

<ul>
<li>Throw hardware at the problem by <strong>adding more memory, adding faster processors, and upgrading disks</strong>.</li>
<li>… add hardware in the form of <strong>additional boxes in a database cluster</strong>. Now you have the problem of data replication and consistency during regular usage and in failover scenarios. You didn’t have that problem before.</li>
<li>Now we need to update the configuration of the database management system. This might mean optimizing the channels the database uses to write to the underlying filesystem. We turn off logging or journaling, which frequently is not a desirable (or, depending on your situation, legal) option.</li>
<li>Having put what attention we could into the database system, we turn to our application. We try to <strong>improve our indexes. We optimize the queries.</strong></li>
<li>We employ a <strong>caching layer</strong>.</li>
<li>We turn our attention to the database again and decide that, now that the application is built and we understand the primary query paths, we can duplicate some of the data to make it look more like the queries that access it. <strong>This process, called denormalization, is antithetical to the five normal forms that characterize the relational model, and violate Codd’s 12 Commandments for relational data.</strong> We remind ourselves that we live in this world, and not in some theoretical cloud, and then undertake to do what we must to make the application start responding at acceptable levels again, <strong>even if it’s no longer “pure.”</strong></li>
</ul>
</blockquote>

<p>It&#8217;s now obvious that we have <strong>mistakenly</strong> learned over the years that <strong>a relational database is a one-size-fits-all solution</strong>.</p>

<blockquote><p>Because of some of the <strong>inherent design decisions in RDBMS</strong>, it is not always as easy to scale as some other, more recent possibilities that take the structure of the Web into consideration. But it’s not only the structure of the Web we need to consider, but also its phenomenal growth, because as more and more data becomes available, <strong>we need architectures that allow our organizations to take advantage of this data in near-time to support decision making and to offer new and more powerful features and capabilities to our customers</strong>.</p></blockquote>

<p>Let&#8217;s look at some statistics:</p>

<blockquote><ul>
<li>YouTube serves 100 million videos every day.</li>
<li>Chevron accumulates 2TB of data every day.</li>
<li>In 2006, the amount of data on the Internet was approximately 166 exabytes (166EB). In 2010, that number reached nearly 1,000 exabytes. An exabyte is one quintillion bytes, or 1.1 million terabytes. To put this statistic in perspective, 1EB is roughly the equivalent of 50,000 years of DVD-quality video. 166EB is approximately three million times the amount of information contained in all the books ever written.</li>
<li>Wal-Mart’s database of customer transactions is reputed to have stored 110 terabytes in 2000, recording tens of millions of transactions per day. By 2004, it had grown to half a petabyte.</li>
<li><strong>The movie Avatar required 1PB storage space</strong>, or the equivalent of a single MP3 song—if that MP3 were 32 years long (source: <a href="http://bit.ly/736XCz">http://bit.ly/736XCz</a>).</li>
<li>As of May 2010, Google was provisioning 100,000 Android phones every day, all of which have Internet access as a foundational service.</li>
<li>In 1998, the number of email accounts was approximately 253 million. By 2010, that number is closer to 2 billion.</li>
</ul>
</blockquote>

<p>Considering the now we faced &#8220;Web Scale&#8221; problem, here is a piece of interesting historical story:</p>

<blockquote><p>It has been said, though it is hard to verify, that the 17th-century English poet <strong>John Milton</strong> had actually <strong>read every published book on the face of the earth</strong>. Milton knew many languages (he was even learning Navajo at the time of his death), and given that the total number of published books at that time was in the thousands, this would have been possible. The size of the world’s data stores have grown somewhat since then.</p></blockquote>

<p><strong>In a world now working at web scale and looking to the future, NoSQL is a great tool at hand for us developers to tackle the scaling problem.</strong></p>

<p>Apache Cassandra might be one part of the answer.</p>

<p>But also we must be aware of the <strong>NoSQL-ALL-THE-THINGS</strong> attempts:</p>

<blockquote><p>If massive, elastic scalability is not an issue, the trade-offs in relative complexity of a system such as Cassandra may simply not be worth it.</p></blockquote>

<h2>The Cassandra Elevator Pitch</h2>

<p>This is a summary of what Cassandra is all about. Since I am not familiar with it (yet), it&#8217;s basically just quotes from the book.</p>

<h3>Cassandra in 50 Words or Less</h3>

<blockquote><p><strong>Apache Cassandra is an open source, distributed, decentralized, elastically scalable, highly available, fault-tolerant, tuneably consistent, column-oriented database that bases its distribution design on Amazon’s Dynamo and its data model on Google’s Bigtable. Created at Facebook, it is now used at some of the most popular sites on the Web.</strong></p></blockquote>

<h3>Distrubuted and Decentrailized</h3>

<blockquote><p>… Cassandra is distributed, which means that it is capable of running on multiple machines while appearing to users as a unified whole. <strong>In fact, there is little point in running a single Cassandra node.</strong></p>

<p>… You can <strong>confidently write data to anywhere in the cluster</strong> and Cassandra will get it.</p>

<p>Once you start to scale many other data stores (MySQL, Bigtable), some nodes need to be set up as masters in order to organize other nodes, which are set up as slaves. Cassandra, however, is decentralized, meaning that every node is identical; no Cassandra node performs certain organizing operations distinct from any other node. <strong>Instead, Cassandra features a peer-to-peer protocol and uses gossip to maintain and keep in sync a list of nodes that are alive or dead.</strong></p>

<p>In many distributed data solutions (such as RDBMS clusters), you set up multiple copies of data on different servers in a process called replication, which copies the data to multiple machines so that they can all serve simultaneous requests and improve performance. <strong>Typically this process is not decentralized as in Cassandra, but is rather performed by defining a master/slave relationship.</strong></p>

<p>… <strong>The decentralized design is therefore one of the keys to Cassandra’s high availability</strong>. Note that while we frequently understand master/slave replication in the RDBMS world, <strong>there are NoSQL databases such as MongoDB that follow the master/slave scheme as well.</strong></p></blockquote>

<h3>Elastic Scalability</h3>

<blockquote><p><strong>Scalability is an architectural feature of a system that can continue serving a greater number of requests with little degradation in performance.</strong></p>

<p>Elastic scalability refers to a special property of horizontal scalability. It means that your cluster can seamlessly scale up and scale back down. … You don’t have to restart your process. You don’t have to change your application queries. You don’t have to manually rebalance the data yourself. <strong>Just add another machine—Cassandra will find it and start sending it work.</strong></p></blockquote>

<h3>Tuneable Consistency</h3>

<p><strong>Consistency essentially means that a read always returns the most recently written value.</strong></p>

<blockquote><p>… scaling data stores means making certain trade-offs between <strong>data consistency</strong>, <strong>node availability</strong>, and <strong>partition tolerance</strong>.</p></blockquote>

<p><strong>Cassandra is frequently called “eventually consistent”.</strong></p>

<blockquote><p>Eventual consistency means on the surface that all updates will propagate throughout all of the replicas in a distributed system, but that this may take some time. Eventually, all replicas will be consistent.</p></blockquote>

<p>When considering consistency, availability, and partition tolerance, we can achieve <strong>only two of these goals</strong> in a given distributed system (See <strong>CAP Theorem</strong> later in this article). At the center of the problem is data update replication. To achieve a strict consistency, all update operations will be performed synchronously, meaning that they must block, locking all replicas until the operation is complete, and forcing competing clients to wait. A side effect of such a design is that during a failure, some of the data will be entirely unavailable. <strong>As Amazon CTO Werner Vogels puts it, “rather than dealing with the uncertainty of the correctness of an answer, the data is made unavailable until it is absolutely certain that it is correct”</strong> (&#8220;Dynamo: Amazon’s Highly Distributed Key-Value Store” :<a href="http://www.allthingsdistributed.com/2007/10/amazons_dynamo.html">http://www.allthingsdistributed.com/2007/10/amazons_dynamo.html</a>)</p>

<p>We could alternatively take an optimistic approach to replication, propagating updates to all replicas in the background in order to avoid blowing up on the client. <strong>The difficulty this approach presents is that now we are forced into the situation of detecting and resolving conflicts.</strong> A design approach must decide whether to resolve these conflicts at one of two possible times: during reads or during writes. <strong>That is, a distributed database designer must choose to make the system either always readable or always writable.</strong></p>

<p><strong>Dynamo and Cassandra choose to be always writable</strong>, opting to defer the complexity of reconciliation to read operations, and realize tremendous performance gains. The alternative is to reject updates amidst network and server failures.</p>

<blockquote><p><strong>In Cassandra, consistency is not an all-or-nothing proposition, so we might more accurately term it “tuneable consistency” because the client can control the number of replicas to block on for all updates.</strong> This is done by setting the <em>consistency level</em> against the <em>replication factor</em>.</p>

<p>The <strong>replication factor</strong> lets you decide how much you want to pay in performance to gain more consistency. <strong>You set the replication factor to the number of nodes in the cluster you want the updates to propagate to</strong> (remember that an update means any add, update, or delete operation).</p>

<p>The <strong>consistency level</strong> is <strong>a setting that clients must specify on every operation</strong> and that allows you to decide how many replicas in the cluster must <strong>acknowledge a write operation</strong> or <strong>respond to a read operation</strong> in order to be considered successful. <strong>That’s the part where Cassandra has pushed the decision for determining consistency out to the client.</strong></p>

<p>So if you like, you could <strong>set the consistency level to a number equal to the replication factor</strong>, and <strong>gain stronger consistency at the cost of synchronous blocking operations that wait for all nodes to be updated and declare success before returning</strong>. This is not often done in practice with Cassandra, however, for reasons that should be clear (it defeats the availability goal, would impact performance, and generally goes against the grain of why you’d want to use Cassandra in the first place). <strong>So if the client sets the consistency level to a value less than the replication factor, the update is considered successful even if some nodes are down.</strong></p></blockquote>

<h3>Brewer’s CAP Theorem</h3>

<blockquote><p>While working at University of California at Berkeley, Eric Brewer posited his CAP theorem in 2000 at the ACM Symposium on the Principles of Distributed Computing. The theorem states that within a large-scale distributed data system, there are three requirements that have a relationship of sliding dependency: <strong>Consistency</strong>, <strong>Availability</strong>, and <strong>Partition Tolerance</strong>.</p>

<p><strong>Consistency</strong></p>

<p>All database clients will read the same value for the same query, even given concurrent updates.</p>

<p><strong>Availability</strong></p>

<p>All database clients will always be able to read and write data.</p>

<p><strong>Partition Tolerance</strong></p>

<p>The database can be split into multiple machines; it can continue functioning in the face of network segmentation breaks.</p></blockquote>

<p>Brewer’s theorem is that in any given system, you can strongly support only two of the three. <strong>This is analogous to the saying you may have heard in software development: “You can have it good, you can have it fast, you can have it cheap: pick two.”</strong></p>

<p>The CAP theorem was formally proved to be true by Seth Gilbert and Nancy Lynch of MIT in 2002. In distributed systems, however, it is very likely that you will have network partitioning, and that at some point, machines will fail and cause others to become unreachable. Packet loss, too, is nearly inevitable. <strong>This leads us to the conclusion that a distributed system must do its best to continue operating in the face of network partitions (to be Partition-Tolerant), leaving us with only two real options to choose from: Availability and Consistency.</strong></p>

<p><strong>Where different databases appear on the CAP continuum</strong></p>

<p><img src="http://forresty.com/images/CAP-databases.png" alt="Where different databases appear on the CAP continuum" /></p>

<blockquote><p><strong>In this depiction, relational databases are on the line between Consistency and Availability, which means that they can fail in the event of a network failure (including a cable breaking).</strong> This is typically achieved by defining a single master server, which could itself go down, or an array of servers that simply don’t have sufficient mechanisms built in to continue functioning in the case of network partitions.</p></blockquote>

<p>What does it mean in practical terms to support only two of the three facets of CAP?</p>

<blockquote><p><strong>CA</strong></p>

<p><strong>To primarily support Consistency and Availability means that you’re likely using two-phase commit for distributed transactions.</strong> It means that the system will block when a network partition occurs, so it may be that your system is limited to a single data center cluster in an attempt to mitigate this. If your application needs only this level of scale, this is easy to manage and allows you to rely on familiar, simple structures.</p>

<p><strong>CP</strong></p>

<p>To primarily support Consistency and Partition Tolerance, you may try to advance your architecture by setting up data shards in order to scale. Your data will be consistent, <strong>but you still run the risk of some data becoming unavailable if nodes fail.</strong></p>

<p><strong>AP</strong></p>

<p>To primarily support Availability and Partition Tolerance, your system <strong>may return inaccurate data</strong>, but the system will <strong>always be available</strong>, even in the face of network partitioning. <strong>DNS is perhaps the most popular example of a system that is massively scalable, highly available, and partition-tolerant.</strong></p></blockquote>

<h3>Row-Oriented</h3>

<blockquote><p>… although it’s not wrong to say that Cassandra is columnar or column-oriented, it might be more helpful to think of it as an indexed, row-oriented store.</p></blockquote>

<p><strong>Cassandra stores data in what can be thought of for now as a multidimensional hash table.</strong> That means you don’t have to decide ahead of time precisely what your data structure must look like, or what fields your records will need. This can be useful if you’re in startup mode and are adding or changing features with some frequency. It is also attractive if you need to support an Agile development methodology and aren’t free to take months for up-front analysis.</p>

<blockquote><p>… Cassandra requires a shift in how you think about data. Instead of designing a pristine data model and then designing queries around the model as in RDBMS, <strong>you are free to think of your queries first, and then provide the data that answers them</strong>.</p></blockquote>

<h3>Schema-Free</h3>

<p><strong>Cassandra requires you to define an outer container, called a keyspace, that contains column families.</strong> The keyspace is essentially just a logical namespace to hold column families and certain configuration properties. The column families are names for associated data and a sort order. <strong>Beyond that, the data tables are sparse, so you can just start adding data to it, using the columns that you want; there’s no need to define your columns ahead of time.</strong> Instead of modeling data up front using expensive data modeling tools and then writing queries with complex join statements, Cassandra asks you to model the queries you want, and then provide the data around them.</p>

<h2>Use Cases for Cassandra</h2>

<ul>
<li>Large Deployments</li>
<li>Lots of Writes, Statistics, and Analysis</li>
<li>Geographical Distribution</li>
<li>Evolving Applications</li>
</ul>


<h2>Who is Using Cassandra?</h2>

<ul>
<li><strong>Twitter</strong> is using Cassandra for analytics. In a much-publicized blog post (at <a href="http://engineering.twitter.com/2010/07/cassandra-at-twitter-today.html">http://engineering.twitter.com/2010/07/cassandra-at-twitter-today.html</a>, Twitter’s primary Cassandra engineer, Ryan King, explained that <strong>Twitter had decided against using Cassandra as its primary store for tweets</strong>, as originally planned, but would instead use it in production for several different things: for real-time analytics, for geolocation and places of interest data, and for data mining over the entire user store.</li>
<li>Mahalo uses it for its primary near-time data store.</li>
<li><strong>Facebook</strong> still uses it for inbox search, though they are using a proprietary fork.</li>
<li>Digg uses it for its primary near-time data store.</li>
<li>Rackspace uses it for its cloud service, monitoring, and logging.</li>
<li><strong>Reddit</strong> uses it as a persistent cache.</li>
<li>Cloudkick uses it for monitoring statistics and analytics.</li>
<li>Ooyala uses it to store and serve near real-time video analytics data.</li>
<li>SimpleGeo uses it as the main data store for its real-time location infrastructure.</li>
<li>Onespot uses it for a subset of its main data store.</li>
</ul>


<h2>Interesting Quotes from Book</h2>

<p>If at first the idea is not absurd, then there is no hope for it. &#8211; Albert Einstein</p>

<p>If I had asked people what they wanted, they would have said faster horses. &#8211; Henry Ford</p>

<p>If you can’t split it, you can’t scale it. &#8211; Randy Shoup, Distinguished Architect, eBay</p>

<p>An invention has to make sense in the world in which it is finished, not the world in which it is started. &#8211; Ray Kurzweil</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[You may win a battle, but you've lost a war]]></title>
    <link href="http://forresty.com/blog/2012/07/15/you-have-lost-a-war/"/>
    <updated>2012-07-15T04:09:00+08:00</updated>
    <id>http://forresty.com/blog/2012/07/15/you-have-lost-a-war</id>
    <content type="html"><![CDATA[<p>对豆瓣上空军一号<a href="http://movie.douban.com/review/1009222/">这篇影评</a>的分析，已经在豆瓣上作为评论回复给原作者 ：D</p>

<hr />

<p>颇有气势的标题，足够吸引眼球。</p>

<p>开头第一段开门见山地立论，较有气势。</p>

<p>全文 1238 字，从第二段开始到「但同时又多象一个神话啊！ 」作者用了 700 字添油加醋地复述了一遍影片剧情，其中多次使用排比和反问的句式反复煽动读者的情绪，并在正式阐述自己看法之前用一连串的感叹号把情绪推到高潮。</p>

<p>接下来的 502 字作者终于开始阐述自己的观点。主要观点无非是美国利用自己的力量强行推广自己的意识形态，导致战乱四起，流血冲突不断。美国有罪。</p>

<p>如果作者仅仅想表达美国不是那么完美无瑕的就算了，这点当然是对的。人是不完美的，用来规范人类行为的制度当然也不可能是完美的。但是接下来这段话露馅了：</p>

<p>「但我完全不解的是，我们这样一个有如此深厚底蕴和浓烈意识形态色彩的国家，怎么会有相当一批精英分子长年追随这些不着四六的东西？怎么会人云亦云地重复骗子自己都不信的几个概念？怎么会以做“一夜美国人”为豪？ 」</p>

<p>朋友啊，你不解不代表别人不解，你不信不代表别人不信。你不解又不赶紧想办法解，却在这里长篇大论，这种公众场合大声放屁的行为无论如何都让人不爽。</p>

<p>何况你的屁又响又臭。</p>

<p>「深厚底蕴和浓烈意识形态色彩」是最不值钱的东西，爱国主义是最好的避难所。正是有这些盲目的激情，缺乏教育的广大民众容易被别有用心的一小撮人所操纵，以达到这些人不可告人的目的。帝国主义，军国主义，纳粹都是这么出来的。</p>

<p>我们更需要的不是像你这样的煽动情绪的技巧，而是理性地去认识别人的优点和过人之处，去了解我们近代这几百年来到底是怎么输掉的。这也就是你不了解的「怎么会有相当一批精英分子长年追随这些不着四六的东西」。</p>

<p>只能说你的煽动性技巧不错。最好玩的是你在倒数第二段说道：</p>

<p>「辞藻华丽的枪稿可能还会继续蒙蔽一部分人，但是会有越来越多的人跳过枪稿，阅读正文。」</p>

<p>咦，你是在说自己辞藻华丽么？：D</p>

<p>我实在是很好奇你这样的写作手法是不是有门派有套路的。标题、开头和前半部分都很有气势，让部分容易激动的读者血冲脑门，于是在阅读下半部分最关键的论点部分时就容易不用心推敲从而对作者的观点唯唯诺诺点头称是。</p>

<p>你站在那一边，选择这样的角度写下了这样的一篇文章，就已经输了。You may win a battle, but you&#8217;ve lost a war.</p>
]]></content>
  </entry>
  
</feed>
