
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Forrest Ye's Blog</title>
  <meta name="author" content="Forrest Ye">

  
  <meta name="description" content="It&#8217;s been more than a year since I took a leave from a startup I helped founded. After my departure, I decided to dedicate my time to seek &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://forresty.com/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Forrest Ye's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12985731-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Forrest Ye's Blog</a></h1>
  
    <h2>Connecting the dots</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/hire">Hire Me</a></li>
  <li><a href="/about">About Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/13/seeking-answers/">Seeking Answers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-13T14:34:00+08:00" pubdate data-updated="true">Dec 13<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It&#8217;s been more than a year since I took a leave from a startup I helped founded.</p>

<p>After my departure, I decided to dedicate my time to seek answers to a lot of questions, the questions which have been haunting me for a long time already.</p>

<p>I want to know more about the world. I want to know more about everything. I want to know more about myself.</p>

<p>What is the meaning of life? What is my purposes of living? What about my future, the future of the people I care about, my parents and my extended family? What is the future of this country?</p>

<p>I don&#8217;t have any idea.</p>

<p>Good thing is I know money is not my goal. Although I don&#8217;t have a lot, I found that I had enough to sustain myself for a while, so I decided to let it go, and see what would happen.</p>

<p>Since I&#8217;ve never really played enough when I grew up, first I found myself diving into video games. Quickly I found the pleasures of them mildly at best.</p>

<p>Then I took a trip into movies and TV shows. At first I learned a lot from them, namely casual English, western culture, different beliefs and different lifestyles.</p>

<p>But soon I realized that they are the products of pop culture and driven by consumerism. The information and knowledge you can find in them are shallow at best. They are designed so that the majority of the people can grasp them. <a href="/blog/2012/07/05/on-black-mirror/">I denounced pure consumerism</a>.</p>

<p>Also, there is a chunk load of nihilism in games, movies and TV shows.</p>

<p>Then I submerged into the information overload, and found Twitter to be the heaven of immediate, fragmented, overflown information. Relentlessly I looked for and followed <a href="https://twitter.com/forresty/following">a lot of wonderful people</a>, some of them become my heroes. I observed them closely. I was obsessed with every bit of information they spit out. I want to learn from them.</p>

<p>Also, there is this site called <a href="http://9gag.com">http://9gag.com</a>, and through 9gag I discovered <a href="http://reddit.com">http://reddit.com</a>. Where pop culture meets information overload.</p>

<p>But later I realized that <a href="/blog/2012/11/20/serious/">being a bystander is not fun</a>. And I found patterns emerged from the informations. There is a bigger picture. I <a href="/blog/2012/11/17/anti-social-at-its-best/">moved</a> <a href="/blog/2012/12/08/hacker-news/">on</a>.</p>

<p>I <a href="/blog/2012/10/15/smoking-and-quitting/">smoked and quitted</a>. I tasted weeds. I took risks and experienced a lot of mindless physical pleasures.</p>

<p>I sneak-peeked into religions, and found no peace of mind there.</p>

<p>I bought stuffs, and now I find myself heading back to <a href="/blog/2012/12/11/my-stuffs/">minimalism</a>.</p>

<p>I realized that this is an age of entertainment. To protest, I enclosed myself with books. Several times I found myself spent consecutive sleepless days and nights reading. Just DEAR (Drop Everything And Read).</p>

<p>I found philosophy. A whole new world.</p>

<p>But still, in the community of book lovers, I found a lot of people retreated into escapism or defeatism.</p>

<p>And now I am so puzzled.</p>

<p>People of the world, I have questions for you:</p>

<p>Working people who are proud of being professional, are you just believing in hedonism, working hard just in order to play harder? Are you an excellent human being or just fighting to become a really, really excellent sheep? Are you self-liberating or just enjoying self annihilation?</p>

<p>Social activists who claim that you are to make China a better place, do you really know what you are doing? Do you know how to build as well as how to pose mass destruction?</p>

<p>Celebrities in China, do you really believe that you are controlling the media, or are you just submitting yourselves to the mass, to this age of entertainment?</p>

<p>Party leaders of the Communist Party of China, have you thought about that you are mortal and just a small chapter in the human history?</p>

<p>Engineers, entrepreneurs and all the producers who are trying to push the human race forward, do you know that you might be doing just the opposite and helping the evil? Are you planning to help the people or just enjoy yourselves?</p>

<p>Everyone else, do you have a purpose of life? Have you given a serious thought about that you are going to die some day, and your time is limited?</p>

<p>Sadly for me, I found that most of my types of people are in the U.S., but my roots remain here in China.</p>

<p>I also found that no matter know wonderful a person was, when he labeled himself as a group member of whatever it is, he often degraded quickly.</p>

<p>Therefore I decided to stand for individualism and fight against any kind of collectivism for as long as I sustain.</p>

<p>But I still haven&#8217;t found what I am looking for.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/11/ayi-loves-you/">ayi loves you</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-11T17:26:00+08:00" pubdate data-updated="true">Dec 11<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I read a lot of open source code, some of them are really nice, some of them suck.</p>

<p>Since I have my TextMate 2 set up so trailing whitespace and <code>\t</code> in Ruby files are highlighted, every now and then when I stumble upon those patterns, I find myself fixing them locally, and depending on my mood, I might send them a pull request.</p>

<p>Though I have a keyboard shortcut set up in my TextMate so it&#8217;s just a trivial task for each file, but it&#8217;s really annoying to see them coming up again and again, right?</p>

<p>When yesterday my <a href="https://github.com/capistrano/capistrano/pull/319">pull request to capistrano</a> was rejected and was told by this nice guy called Roy Liu, that rather than fixing them file by file, it&#8217;s preferred to do it in batch.</p>

<p>So today I literally went through the entire project, read through the code, trying to understand them while fixing the styles. Oh man it hurts my eyes.</p>

<p>Obviously some tasks are better done using automation. Thus in a hurry I wrote this little <a href="https://github.com/forresty/ayi">ayi gem</a>.</p>

<p>Basically it clean up codes for you, and I intend to make it do this one thing and do it well.</p>

<p>Of course It&#8217;s now still very early in development, but let&#8217;s hope it will become more and more powerful as time goes by.</p>

<p>Go <a href="https://github.com/forresty/ayi">take a look at it</a> if you are interested.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/11/my-stuffs/">My Stuffs</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-11T13:52:00+08:00" pubdate data-updated="true">Dec 11<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I <a href="/blog/2012/11/17/anti-social-at-its-best/">blogged about simplifying my life</a> and mentioned about a list of my stuffs, since I know some of you might be interested, I am now making it public.</p>

<p><a href="/stuffs">Here is the list</a>.</p>

<p>It&#8217;s undergoing constant changes of course, I may try, but I make no promises to keep it up-to-date here.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/09/thinking-out-loud/">THINKING OUT LOUD</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-09T13:55:00+08:00" pubdate data-updated="true">Dec 9<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This world is full of thoughtful thinkers who don&#8217;t speak out loud enough, talkative hyperactive doers who don&#8217;t think enough, passive nihilistic people who hate this world and hate themselves, and mindless lazy people who know nothing but to lamely entertain themselves.</p>

<p>So I say, hey sexy world, I am here to make you a better place.</p>

<p>I intend to think out loud till I feel I&#8217;ve satisfied myself.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/09/mbti-explained/">MBTI explained</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-09T10:59:00+08:00" pubdate data-updated="true">Dec 9<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So I <a href="http://forresty.com/blog/2012/12/06/intp/">blogged about me taking online MBTI tests again</a> and found myself have changed from the ENFP type to INTP type and might become an INTJ without telling you guys what MBTI is and wtf are ENFP and INTP and INTJ.</p>

<p>Okay I know most of you are either too lazy or too busy to look into those jargons yourselves, so I am here to give a brief talk about MBTI.</p>

<p>So basically <a href="http://en.wikipedia.org/wiki/Myers-Briggs_Type_Indicator">MBTI</a> is an indicator which reflects your psychological preferences and how you perceive the world and make decisions. It&#8217;s based on the work of <a href="http://en.wikipedia.org/wiki/Carl_Jung">Carl Jung</a> if you are wondering.</p>

<p>There are many free online MBTI tests in languages of your preferences, just Google it yourself. I took several quick ones in both Chinese and English just to make sure the results are consistent.</p>

<p>The MBTI basically categorize people into 16 groups based on 4 sub-types (2 ^ 4 == 16, hence the 4 character type name ENFP or INTJ).</p>

<p>Those sub-types are:</p>

<ul>
<li>Extraversion (E) –  (I) Introversion</li>
<li>Sensing (S) –   (N) Intuition</li>
<li>Thinking (T) –  (F) Feeling</li>
<li>Judging (J) –   (P) Perception</li>
</ul>


<h2>Extraversion (E) – (I) Introversion</h2>

<p>Basically extraverts feels more comfortable when spending time with people, while introverts get their energy from spending time alone.</p>

<h2>Sensing (S) –  (N) Intuition</h2>

<p>People who prefer sensing are data oriented, they prefer to look for details and facts, while intuition people tend to seek the meaning in the underlying theory and principles which are manifested in the data.</p>

<h2>Thinking (T) – (F) Feeling</h2>

<blockquote><p>Thinking and feeling are the decision-making functions. Those who prefer thinking tend to decide things from a more detached standpoint, measuring the decision by what seems reasonable, logical, causal, consistent, and matching a given set of rules. Those who prefer feeling tend to come to decisions by associating or empathizing with the situation, looking at it &#8216;from the inside&#8217; and weighing the situation to achieve, on balance, the greatest harmony, consensus and fit, considering the needs of the people involved. - Wikipedia</p></blockquote>

<p>Therefore thinkers are often perceived to have a bigger ego.</p>

<h2>Judging (J) –  (P) Perception</h2>

<p>Judging and Perception represent the lifestyles you choose. People who prefer perception are generally more passive, seeking to understand the world as it is, while judging people prefer to act, to make a difference.</p>

<h2>About My Types</h2>

<p>I was an ENFP hence I was more of a product manager / program manager type of guy. Oh, and many passionate revolutionaries are of this type.</p>

<p>Since I realized I was not satisfied with that, therefore I changed myself from E to I and from F to T, and now I am an INTP.</p>

<p>By becoming an INTP I find myself in the same group with most scientists and philosophers, but I don&#8217;t like it as of this moment.</p>

<p>Thus I am becoming an INTJ.</p>

<p>Simply put, I prefer to become more like Elon Musk than Larry Page or Sergey Brin or Albert Einstein.</p>

<h2>Final Notes</h2>

<p>MBTI is just a method to group people into sub-groups. Don&#8217;t take it too seriously.</p>

<p>After all, there are only 16 groups, and even if you are in the rarest group, or you may prefer, the most elite group, 1% * 6 billion is still a very large number.</p>

<p>And there are still people like me who are well aware of the system and are willing to hack their own minds, and are capable of taking actions to change their types on demand and have succeeded.</p>

<p>Take that.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/08/hacker-news/">Hacker News</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-08T12:48:00+08:00" pubdate data-updated="true">Dec 8<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>Germany has declared war on Russia. Swimming in the afternoon. -Franz Kafka&#8217;s diary entry of August 2, 1914</p></blockquote>

<p>When you are seeking to understand the fundamental logics and reasons of this world, sooner or later you&#8217;ll come to realize that daily trivial matters are of no importance at all.</p>

<p>Thus I abandoned a private experimental Hacker News iOS app roughly 5 months ago, because I realized that I don&#8217;t want to pay that much attention to news any more.</p>

<p>It&#8217;s now open source on GitHub <a href="https://github.com/forresty/Hackish">https://github.com/forresty/Hackish</a>.</p>

<p>Mind you, the code sucks. It stinks, it smells. I haven&#8217;t touched a single line of Objective-C after that (except spending half an hour to clean it up last night), but I believe I can now easily write at least 5 times better in less than 1/3 of the time.</p>

<p>But still, since I&#8217;ve seen a lot of pretentious people pretending that they know how to write iOS code, I think what the hell, opening this shit up to the world might not make it a worse place.</p>

<p>If you go read it and think &#8220;LOL, this guy sucks&#8221;, then thank you, you motivate me.</p>

<p>I tried to be humble, but this world seems to ignore humble people.</p>

<p>So I say fuck this shit, I&#8217;d better be hated or laughed at than be ignored.</p>

<p>Come judge me.</p>

<p>UPDATE: corrections on Kafka&#8217;s diary. BTW for a good example of well-written iOS client code, check out Cheddar by Sam Soffes <a href="https://github.com/nothingmagical/cheddar-ios">https://github.com/nothingmagical/cheddar-ios</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/07/sweet-tweets/">sweet tweets</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-07T21:48:00+08:00" pubdate data-updated="true">Dec 7<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>I hate to break it to you, but your product does not depend on elegance of code. It depends on positioning and marketing. Embrace that. - @holman</p></blockquote>

<p><a href="https://twitter.com/holman/status/277004349333467136">https://twitter.com/holman/status/277004349333467136</a></p>

<blockquote><p>Why are engineer founders are on the rise? Businessmen create that which has worked in the past. Engineers create that which has never been. - @kneath</p></blockquote>

<p><a href="https://twitter.com/kneath/status/273869571360956416">https://twitter.com/kneath/status/273869571360956416</a></p>

<blockquote><p>Internet comments would be great if you could filter them by “Has this user accomplished anything? Anything at all?” - @holman</p></blockquote>

<p><a href="https://twitter.com/holman/status/272800396802670592">https://twitter.com/holman/status/272800396802670592</a></p>

<blockquote><p>$PATH is dependency injection for Unix. It doesn’t need to be complicated. - @sstephenson</p></blockquote>

<p><a href="https://twitter.com/sstephenson/status/270673707389841408">https://twitter.com/sstephenson/status/270673707389841408</a></p>

<blockquote><p>What if you designed a web framework around the error messages displayed to developers? - @kneath</p></blockquote>

<p><a href="https://twitter.com/kneath/status/263062829375041536">https://twitter.com/kneath/status/263062829375041536</a></p>

<p>There are reasons why companies like GitHub and 37signals are awesome.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/07/meditation/">meditation</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-07T20:58:00+08:00" pubdate data-updated="true">Dec 7<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If you need meditation in order to clear your mind, that&#8217;s called finding focus / getting into the zone.</p>

<p>If you need meditation because you feel a little bit burnt out, that&#8217;s called resting.</p>

<p>If you need meditation because you don&#8217;t know what to do, that&#8217;s called thinking.</p>

<p>If you have work to do but you think you need to meditate, that&#8217;s called procrastination.</p>

<p>If you fell asleep during meditation, that&#8217;s called sleeping.</p>

<p>Steve Jobs practiced meditation, Elon Musk may have done drugs, super heroes in Ayn Rand&#8217;s books smoke. They might helped, but they are not why those people are successful.</p>

<p>Just stop pretending and start to get things done.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/06/intp/">INTP</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-06T14:38:00+08:00" pubdate data-updated="true">Dec 6<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Just took another MBTI test, it seems now I am an INTP.</p>

<p>Apparently I&#8217;ve changed a lot since last time (roughly 3~4 years ago) I took the test I was an ENFP. I think it&#8217;s likely that I&#8217;ve had stayed ENFPish till last year or so (while recently I gradually moved from Extraversion to Introversion and Feeling to Thinking).</p>

<p>But I might want myself to be an INTJ, since INTJs are more on the &#8220;doer&#8221; side while INTPs are more on the &#8220;thinker&#8221; side.</p>

<p>So, how can I make myself move towards INTJ?</p>

<p>Maybe keep &#8220;thinking&#8221; how is not the right answer, right? ;)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/04/introducing-dotjs-pow/">Introducing dotjs-pow</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-04T14:06:00+08:00" pubdate data-updated="true">Dec 4<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I just released a small piece of code called <a href="https://github.com/forresty/dotjs-pow">dotjs-pow</a> on GitHub, before I tell you what it is, let me tell you a short story first.</p>

<p>You see, recently, I read a lot of books. I bought most of them on <a href="http://amazon.cn">amazon.cn</a> since you know, dead-tree versions of Chinese books are dirt cheap.</p>

<p>And also, there is this Chinese site <a href="http://douban.com">douban.com</a>, which has generally pretty reliable Chinese book ratings and reviews, and you know what, they have some nice APIs too!</p>

<p>Since I find myself constantly switching Safari tabs between pages from amazon.cn and douban.com, I started to think that how can I make this easier.</p>

<p>Initially, I thought about building a Safari extension, but it is not an elegant solution.</p>

<p>Then I found this awesome piece of code called <a href="https://github.com/defunkt/dotjs">dotjs</a> by GitHub CEO(!) Chris Wanstrath (a.k.a. defunkt), basically it lets you run a custom js file located in your <code>~/.js</code> each time you visit a site.</p>

<p>&#8220;Yes!&#8221;, I think, so in a hurry I installed it (albeit I have to install <a href="https://github.com/wfarr/dotjs.safariextension">dotjs.safariextension</a> as well since defunkt was a Chrome guy) and put following code in my <code>~/.js/amazon.cn.js</code> to put it to a test:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">url</span> <span class="o">:</span> <span class="s1">&#39;http://api.douban.com/book/subjects?alt=json&amp;q=9787533935030&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">type</span> <span class="o">:</span> <span class="s1">&#39;get&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">dataType</span> <span class="o">:</span> <span class="s1">&#39;JSON&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">success</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;yay!&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">failure</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;meh&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>And points my Safari to amazon.cn. As you might have already guessed, I saw this in Safari console:</p>

<p><img src="/images/Access-Control-Allow-Origin.png" alt="Access-Control-Allow-Origin.png" /></p>

<p>Hmm. Typical.</p>

<p>Since I don&#8217;t control either amazon.cn or douban.com, one solution is that I build an API proxy for api.douban.com.</p>

<p>It&#8217;s quite easy to do so using Sinatra and HTTParty:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;httparty&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">disable</span> <span class="ss">:protection</span>
</span><span class='line'>
</span><span class='line'><span class="n">get</span> <span class="s1">&#39;/api/douban/book/isbn/:isbn&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">headers</span> <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json; charset=utf-8&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">HTTParty</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://api.douban.com/book/subjects?alt=json&amp;q=</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:isbn</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">body</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>But of course I don&#8217;t want to put the proxy on the Internet! So am I going to run yet another service on my localhost? Hmm, I don&#8217;t like ugly hacks.</p>

<p>Then I realized <code>djsd</code> used by dotjs is just a static file server, and since I already have a Rack-compliant <a href="https://github.com/37signals/pow">Pow</a> running on my machine (as many Rubyists do), why not just build a Pow powered dotjs server, which can also be used to bypass cross-site security protections as well?</p>

<p>Thus <a href="https://github.com/forresty/dotjs-pow">dotjs-pow</a> was born.</p>

<p>And with following codes in my <code>~/.js/amazon.cn.js</code>, job&#8217;s done.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">trim</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s+|\s+$/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isbnize</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/,.+$/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">trim</span><span class="p">();</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// http://stackoverflow.com/questions/1408289/best-way-to-do-variable-interpolation-in-javascript</span>
</span><span class='line'><span class="nb">String</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">supplant</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/{([^{}]*)}/g</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">o</span><span class="p">[</span><span class="nx">b</span><span class="p">];</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">typeof</span> <span class="nx">r</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">r</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span> <span class="o">?</span> <span class="nx">r</span> <span class="o">:</span> <span class="nx">a</span><span class="p">;</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;b:contains(&quot;ISBN:&quot;)&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">isbn</span> <span class="o">=</span> <span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nextSibling</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">isbnize</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>      <span class="nx">url</span> <span class="o">:</span> <span class="s1">&#39;http://dotjs-pow.dev/api/douban/book/isbn/&#39;</span> <span class="o">+</span> <span class="nx">isbn</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">type</span> <span class="o">:</span> <span class="s1">&#39;get&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">dataType</span> <span class="o">:</span> <span class="s1">&#39;JSON&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">success</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">numRaters</span> <span class="o">=</span> <span class="nx">json</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;gd:rating&#39;</span><span class="p">][</span><span class="s1">&#39;@numRaters&#39;</span><span class="p">];</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">rating</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">json</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;gd:rating&#39;</span><span class="p">][</span><span class="s1">&#39;@average&#39;</span><span class="p">]);</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nx">json</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;link&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;@href&#39;</span><span class="p">];</span>
</span><span class='line'>        <span class="c1">// ratings: 7.9 =&gt; 4_0, 8.5 =&gt; 4_5, 8.6 =&gt; 5_0</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">stars_1</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">rating</span> <span class="o">+</span> <span class="mf">1.4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">stars_2</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">rating</span> <span class="o">+</span> <span class="mf">1.4</span><span class="p">)</span> <span class="o">===</span> <span class="nx">stars_1</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;span class=&quot;swSprite s_star_{stars_1}_{stars_2}&quot; title=&quot;{numRaters} ratings&quot;&gt;&lt;/span&gt;&lt;span&gt;(&lt;a href=&quot;{link}&quot;&gt;{rating}&lt;/a&gt;)&lt;/span&gt;&#39;</span><span class="p">.</span><span class="nx">supplant</span><span class="p">({</span>
</span><span class='line'>          <span class="nx">stars_1</span> <span class="o">:</span> <span class="nx">stars_1</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">stars_2</span> <span class="o">:</span> <span class="nx">stars_2</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">numRaters</span> <span class="o">:</span> <span class="nx">numRaters</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">rating</span> <span class="o">:</span> <span class="nx">rating</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">link</span> <span class="o">:</span> <span class="nx">link</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="nx">html</span><span class="p">).</span><span class="nx">insertAfter</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#btAsinTitle&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">parentNode</span><span class="p">);</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nx">failure</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;something was wrong.&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Check it out in action (please forgive me, I suck at styling web pages&#8230;):</p>

<p><img src="/images/amazon.cn-douban-book-api.png" alt="amazon.cn-douban-book-api.png" /></p>

<p>Oh, of course I have to use <a href="https://github.com/forresty/dotjs-pow.safariextension">a modified version</a> of dotjs.safariextension since I changed the server address from http://localhost:3131 to http://dotjs-pow.dev.</p>

<p>The full source code of app.rb (that is, the dotjs-pow server) is as following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/bin/env ruby</span>
</span><span class='line'>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;bundler&quot;</span>
</span><span class='line'><span class="no">Bundler</span><span class="o">.</span><span class="n">require</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># sometimes, it is more fun to do it without protection</span>
</span><span class='line'><span class="n">disable</span> <span class="ss">:protection</span>
</span><span class='line'>
</span><span class='line'><span class="n">get</span> <span class="s1">&#39;/js/:js_file&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">headers</span> <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/javascript; charset=utf-8&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s2">&quot;~/.js/</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:js_file</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span> <span class="k">rescue</span> <span class="s2">&quot;{}&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">get</span> <span class="s1">&#39;/api/douban/book/isbn/:isbn&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">headers</span> <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json; charset=utf-8&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">HTTParty</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://api.douban.com/book/subjects?alt=json&amp;q=</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:isbn</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">body</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you are a hopeless nerd like me, you might want to check it out yourself, visit <a href="https://github.com/forresty/dotjs-pow">dotjs-pow on GitHub</a> now.</p>

<p>BTW, <a href="/hire">I am currently available for hire</a>.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Forrest Ye -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  










  <script type="text/javascript">
    var _gauges = _gauges || [];
      (function() {
          var t   = document.createElement('script');
          t.type  = 'text/javascript';
          t.async = true;
          t.id    = 'gauges-tracker';
          t.setAttribute('data-site-id', '50c8398e613f5d415e00002a');
          t.src = '//secure.gaug.es/track.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(t, s);
        })();
  </script>




</body>
</html>
